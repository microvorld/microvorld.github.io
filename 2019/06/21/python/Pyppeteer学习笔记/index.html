<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="microworld,bubbl3@foxmail.com"><title>Pyppeteer学习笔记 · damn1t</title><meta name="description" content="Pyppeteer学习笔记有的没的浏览器处理过程中的每一个步骤：1.处理HTML脚本，生成DOM树2.处理CSS脚本，生成CSSOM树   （DOM和CSSOM是独立的数据结构）3.将DOM树和CSSOM树合并为渲染树4.对渲染树中的内容进行布局，计算每个节点的几何外观5.将渲染树中的每个节点绘制到"><meta name="keywords" content="security,pentest,personal"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">damn1t</a></h3><div class="description"><p>及时行乐.</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/www.baidu.com"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/www.baidu.com"><i class="fa fa-weibo"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Pyppeteer学习笔记</a></h3></div><div class="post-content"><h1 id="Pyppeteer学习笔记"><a href="#Pyppeteer学习笔记" class="headerlink" title="Pyppeteer学习笔记"></a>Pyppeteer学习笔记</h1><h2 id="有的没的"><a href="#有的没的" class="headerlink" title="有的没的"></a>有的没的</h2><p>浏览器处理过程中的每一个步骤：<br>1.处理HTML脚本，生成DOM树<br>2.处理CSS脚本，生成CSSOM树   （DOM和CSSOM是独立的数据结构）<br>3.将DOM树和CSSOM树合并为渲染树<br>4.对渲染树中的内容进行布局，计算每个节点的几何外观<br>5.将渲染树中的每个节点绘制到屏幕中</p>
<p>Headless Browser实际就是节约了第4,5步的时间。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>文档地址：<a href="https://miyakogi.github.io/pyppeteer/" target="_blank" rel="noopener">https://miyakogi.github.io/pyppeteer/</a><br>要求的最佳适配环境：py3.6</p>
<p>安装方法：</p>
<ul>
<li><code>pip install pyppeteer</code></li>
<li>安装chromium：<ol>
<li>因为国内的原因，源下载地址被屏蔽了，所以可以利用国内的镜像地址：<a href="https://npm.taobao.org/mirrors/chromium-browser-snapshots/" target="_blank" rel="noopener">https://npm.taobao.org/mirrors/chromium-browser-snapshots/</a>.</li>
<li>由于每次运行时都要指定chromium的路径，我的办法是自己写了个简单的模块，然后每次<code>import</code>，也可以每次在<code>launch</code>中直接引入<code>executablePath</code>的绝对路径</li>
</ol>
</li>
</ul>
<h2 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h2><p>首先要说的是，<a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener">puppeteer</a> 是一个<code>headless</code>的浏览器，由于<code>phantomJS</code>已经被deprecated，Firefox和chrome都已经开发出了自己的headless浏览器，puppeteer是个很好用的东西</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>官方给出了两个实例：</p>
<ol>
<li>截屏</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">from pyppeteer import launch</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    browser = await launch()</span><br><span class="line">    page = await browser.newPage()</span><br><span class="line">    await page.goto(&apos;http://example.com&apos;)</span><br><span class="line">    await page.screenshot(&#123;&apos;path&apos;: &apos;example.png&apos;&#125;)</span><br><span class="line">    await browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre></td></tr></table></figure>
<ol>
<li>调用JS脚本</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">from pyppeteer import launch</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    browser = await launch()</span><br><span class="line">    page = await browser.newPage()</span><br><span class="line">    await page.goto(&apos;http://example.com&apos;)</span><br><span class="line">    await page.screenshot(&#123;&apos;path&apos;: &apos;example.png&apos;&#125;)</span><br><span class="line"></span><br><span class="line">    dimensions = await page.evaluate(&apos;&apos;&apos;() =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            width: document.documentElement.clientWidth,</span><br><span class="line">            height: document.documentElement.clientHeight,</span><br><span class="line">            deviceScaleFactor: window.devicePixelRatio,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&apos;&apos;&apos;)</span><br><span class="line"></span><br><span class="line">    print(dimensions)</span><br><span class="line">    # &gt;&gt;&gt; &#123;&apos;width&apos;: 800, &apos;height&apos;: 600, &apos;deviceScaleFactor&apos;: 1&#125;</span><br><span class="line">    await browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">### 参数 ###</span><br><span class="line">有两种风格：</span><br><span class="line"></span><br><span class="line">- 键值对形式</span><br></pre></td></tr></table></figure>
<p>browser = await launch({‘headless’: True})</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 关键字形式</span><br></pre></td></tr></table></figure>
<p>browser = await launch(headless=True)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 元素选择器 ###</span><br><span class="line">在python中，`$`不被用来命名方法，所以改为了`querySelector`</span><br><span class="line"></span><br><span class="line">`Page.$()/Page.$$()/Page.$x()`都改为了`Page.querySelector()/Page.querySelectorAll()/Page.xpath()`，同样也有速记的方式：`Page.J(), Page.JJ(), and Page.Jx()`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### `Page.evaluate()`和`Page.querySelectorEval()`的参数 ###</span><br><span class="line">`Puppeteer`版本采用了js的原生方法和表达式字符串，但`pyppeteer`采用了js的字符串。js的字符串有时能够被作为函数或表达式，`Pyppeteer `尝试自动监测该字符串是否为函数或表达式，但有时他会失败了，所以 当一个表达式无法被识别，你可以使用`force_expr=True`让它生效</span><br><span class="line">例如：</span><br></pre></td></tr></table></figure>
<p>content = await page.evaluate(‘document.body.textContent’, force_expr=True)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取元素内部文本的示例：</span><br></pre></td></tr></table></figure>
<p>element = await page.querySelector(‘h1’)<br>title = await page.evaluate(‘(element) =&gt; element.textContent’, element)<br>```</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>快一年了，似乎已经停止更新了，orz</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-06-21</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Pyppeteer/" title="Pyppeteer">Pyppeteer </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://microvorld.com/2019/06/21/python/Pyppeteer学习笔记/,damn1t,Pyppeteer学习笔记,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/06/22/python/selenium学习笔记/" title="selenium学习笔记">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/06/19/vulnerable/Bypass XSS filters using JavaScript global variables/" title="Bypass XSS filters using JavaScript global variables（笔记）">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>